"""Flask application that manages surveys backed by SQLite."""

from __future__ import annotations

import datetime
import json
import logging
import os
import uuid
from typing import Any, Dict, Iterable, List, Optional

from dotenv import load_dotenv
from flask import (
    Flask,
    Response,
    abort,
    jsonify,
    render_template_string,
    request,
    stream_with_context,
    send_from_directory,
)
from flask_cors import CORS
from openai import OpenAI
from sqlalchemy import create_engine, event, text
from sqlalchemy.engine import Engine


load_dotenv()

BASE_DIR = os.path.dirname(os.path.abspath(__file__))


def _default_storage_base() -> str:
    """
    Determine where to place writable artifacts (SQLite, uploads).

    When running on Vercel or other serverless providers, the project directory
    is read-only and we must fall back to a tmp filesystem.
    """
    if os.getenv("VERCEL") or os.getenv("VERCEL_ENV"):
        return os.getenv("TMPDIR") or os.getenv("TEMP") or "/tmp"
    return BASE_DIR


STORAGE_BASE = _default_storage_base()


def _resolve_database_url() -> str:
    """
    Determine which database connection string to use.

    Priority:
    1. Vercel managed Postgres environment variables.
    2. Local SQLite file (development fallback only).
    """
    vercel_pg_candidates = [
        os.getenv("POSTGRES_URL"),
        os.getenv("POSTGRES_PRISMA_URL"),
        os.getenv("POSTGRES_URL_NON_POOLING"),
    ]
    for candidate in vercel_pg_candidates:
        if candidate:
            return candidate

    default_sqlite = os.getenv("SQLITE_PATH") or os.path.join(STORAGE_BASE, "app.sqlite3")
    return f"sqlite:///{default_sqlite}"


DATABASE_URL = _resolve_database_url()

_ENGINE_KWARGS: Dict[str, Any] = {"future": True, "pool_pre_ping": True}
if DATABASE_URL.startswith("sqlite"):
    _ENGINE_KWARGS["connect_args"] = {"check_same_thread": False}

engine: Engine = create_engine(DATABASE_URL, **_ENGINE_KWARGS)


if engine.url.get_backend_name() == "sqlite":

    @event.listens_for(engine, "connect")
    def _set_sqlite_pragma(dbapi_connection, connection_record) -> None:
        dbapi_connection.execute("PRAGMA foreign_keys=ON")


ASSET_ROUTE_PREFIX = os.getenv("ASSET_ROUTE_PREFIX", "/uploads")
ASSET_LOCAL_DIR = os.getenv("ASSET_LOCAL_DIR") or os.path.join(STORAGE_BASE, "uploads")
os.makedirs(ASSET_LOCAL_DIR, exist_ok=True)

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

app = Flask(__name__, static_url_path=ASSET_ROUTE_PREFIX, static_folder=ASSET_LOCAL_DIR)

CORS(
    app,
    resources={r"/api/*": {"origins": os.getenv("FRONTEND_ORIGIN", "*")}},
    supports_credentials=False,
)

OPENAI_MODEL = os.getenv("OPENAI_MODEL", "gpt-4o-mini")
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")


def get_openai_client() -> Optional[OpenAI]:
    if not OPENAI_API_KEY:
        return None
    return OpenAI(api_key=OPENAI_API_KEY)


SYSTEM_PROMPT = (
    os.getenv("SYSTEM_PROMPT")
    or (
        '''ä½ æ˜¯ä¸€ä½è¦ªåˆ‡ã€æº–ç¢ºã€å¯å¼•å°Žä¸‹ä¸€æ­¥è¡Œå‹•çš„ã€Œæ¡ƒåœ’å¸‚æ”¿åºœé’å¹´äº‹å‹™å±€ã€æ™ºæ…§å®¢æœåŠ©ç†ã€‚

### ðŸŽ¯ ä½ çš„è§’è‰²å®šä½ï¼š
- èªžæ°£ï¼šå°ˆæ¥­ã€æº«æš–ã€ç°¡æ˜Žï¼›å…ˆç­”å¾Œå¼•å°Žï¼›ä¸å®˜è…”ï¼›ä¸æ‰¿è«¾æœªè¼‰æ˜Žä¹‹æ¬Šè²¬
- çŸ¥è­˜ä¾†æºï¼šåªå…è¨±ä½¿ç”¨æä¾›çš„ã€Šæ¡ƒåœ’å¸‚æ”¿åºœé’å¹´äº‹å‹™å±€çŸ¥è­˜åº«ã€‹ä½œç­”
- å›žç­”æ–¹å¼ï¼šå¿…é ˆè¨»æ˜Žä¿¡æ¯ä¾†æºï¼ˆä¾‹å¦‚ï¼šã€Œæ ¹æ“šã€Šçµ„ç¹”æž¶æ§‹æ–‡ä»¶ã€‹...ã€æˆ–ã€Œä¾æ“šã€Šå¸¸è¦‹å•é¡Œé›†ã€‹...ã€ï¼‰

### ðŸ“š æ ¸å¿ƒåŽŸå‰‡ï¼š
1. **åš´æ ¼ä¾æ“šæ–‡ä»¶å›žç­”**
   - åƒ…å¼•ç”¨æ–‡ä»¶ä¸­æ˜Žç¢ºæ•˜è¿°èˆ‡æ•¸å­—ï¼ˆé‡‘é¡ã€åˆ†æ©Ÿã€æ—¥æœŸã€çµ„ç¹”ã€æ¢ä»¶ã€å—ç†æ™‚ç¨‹ï¼‰
   - è‹¥å•é¡Œè¶…å‡ºæ–‡ä»¶æˆ–æ–‡ä»¶æœªè¼‰æ˜Žï¼Œå‹™å¿…æ˜Žç¢ºèªªã€Œæ–‡ä»¶æœªè¼‰ã€ä¸¦æä¾›å®˜æ–¹è¯çµ¡æ–¹å¼ï¼š
     * ç¸½æ©Ÿï¼š(03) 422-5205
     * å¸‚æ”¿æœå‹™å°ˆç·šï¼š1999ï¼ˆå¤–ç¸£å¸‚ 03-218-9000ï¼‰
     * åœ°å€ï¼š320029 æ¡ƒåœ’å¸‚ä¸­å£¢å€ç’°åŒ—è·¯390è™Ÿï¼ˆä¸­å£¢å€å…¬æ‰€æ—ï¼‰

2. **å›žç­”ä¸€èˆ¬/åŸºç¤Žå•é¡Œ**
   - å–®ä½ä»‹ç´¹ã€æ¥­å‹™è·æŽŒã€è¯çµ¡æ–¹å¼ã€ç§‘å®¤åˆ†æ©Ÿã€å¸¸è¦‹å•ç­”
   - å‰µæ¥­è³‡æºã€é€²é§åŸºåœ°ã€é’å‰µèª²ç¨‹ã€è³‡é‡‘è£œåŠ©ã€æ´»å‹•è£œåŠ©ã€å¿—å·¥æœå‹™ã€ç¤¾å€è¡Œå‹•

3. **æŽ¨è–¦åˆé©æ–¹æ¡ˆ**
   - æ ¹æ“šä½¿ç”¨è€…éœ€æ±‚ï¼ˆå¹´é½¡ã€èº«åˆ†ã€å‰µæ¥­éšŽæ®µã€éœ€æ±‚é¡žåž‹ï¼‰ä¸»å‹•æŽ¨è–¦ï¼š
     * å‰µæ¥­è³‡æºï¼ˆåŸºåœ°ã€èª²ç¨‹ã€è¼”å°Žï¼‰
     * è³‡é‡‘æ”¯æŒï¼ˆè£œåŠ©ã€è²¸æ¬¾ã€åˆ©æ¯è£œè²¼ï¼‰
     * å¿—å·¥æœå‹™ï¼ˆåœ‹å…§ã€åœ‹éš›ã€åŸ¹è¨“ï¼‰
     * ç¤¾æœƒåƒèˆ‡ï¼ˆæ°¸çºŒè¨ˆç•«ã€ç¤¾å€ç‡Ÿé€ ï¼‰
   - æ¯æ¬¡æŽ¨è–¦éœ€åŒ…å«ï¼šæ–¹æ¡ˆåç¨±ã€è£œåŠ©é‡‘é¡ã€ç”³è«‹è³‡æ ¼ã€è¯çµ¡çª—å£ã€ç”³è«‹æ–¹å¼

4. **è¡Œå‹•å¼•å°Žï¼ˆCTAï¼‰**
   - å›žç­”çµå°¾æä¾›å…·é«”è¡Œå‹•å»ºè­°ï¼š
     * ã€ŒðŸ‘‰ éœ€è¦æˆ‘å¹«æ‚¨æ•´ç†ç”³è«‹æ‰€éœ€æ–‡ä»¶æ¸…å–®å—Žï¼Ÿã€
     * ã€ŒðŸ‘‰ è¦ä¸è¦æˆ‘æŠŠæ‰¿è¾¦åˆ†æ©Ÿèˆ‡å¯ç”¨ç¶²å€ä¸€æ¬¡æ•´ç†çµ¦ä½ ï¼Ÿã€
     * ã€ŒðŸ‘‰ å¯ç›´æŽ¥æ’¥æ‰“ (03) 422-5205 åˆ†æ©Ÿ XXXX è©¢å•æ›´å¤šç´°ç¯€ã€

### ðŸ’¡ å›žè¦†é¢¨æ ¼ï¼š
1. å…ˆç”¨ 1-2 å¥è©±ç›´æŽ¥å›žç­”é‡é»ž
2. æŽ¥è‘—ç”¨æ¢åˆ—åˆ—å‡ºè¦é»žï¼ˆé‡‘é¡/å°è±¡/è³‡æ ¼/æ™‚ç¨‹/çª—å£ï¼‰
3. **é‡è¦ï¼šè¨»æ˜Žä¿¡æ¯ä¾†æº**ï¼ˆä¾‹å¦‚ï¼šã€Œä¾æ“šã€Šå¸¸è¦‹å•é¡Œå…¨é›†ã€‹ç¬¬äº”ç« ...ã€ï¼‰
4. æœ€å¾Œæä¾›ã€Œè¡Œå‹•å»ºè­°ã€ï¼šé›»è©±/åˆ†æ©Ÿã€ç¶²ç«™ã€æº–å‚™æ–‡ä»¶
5. è‹¥æ–‡ä»¶æœªè¼‰æ˜Žï¼šæ¸…æ¥šèªªæ˜Žã€Œæœªè¼‰ã€ï¼Œä¸¦æä¾›æ­£ç¢ºæ‰¿è¾¦çª—å£
6. ç”¨ç¹é«”ä¸­æ–‡å›žç­”ï¼Œèªžæ°£æº«æš–è‡ªç„¶

### âš™ï¸ å›žç­”ç¯„ä¾‹ï¼š

**ä½¿ç”¨è€…å•ï¼š**ã€Œå‰›ç•¢æ¥­æƒ³å‰µæ¥­ï¼Œæœ‰å“ªäº›è³‡æºï¼Ÿã€
**å›žç­”ï¼š**
æ‚¨å¯ä»¥ä½¿ç”¨é’å¹´å±€çš„ä¸‰å¤§æ ¸å¿ƒè³‡æºï¼š

1. **é’å‰µåŸºåœ°**ï¼ˆé€²é§ç©ºé–“ï¼‰
   - é’å‰µæŒ‡æ®éƒ¨ã€å®‰æ±é’å‰µåŸºåœ°ã€æ–°æ˜Žé’å‰µåŸºåœ°
   - æä¾›ç¨ç«‹è¾¦å…¬å®¤ã€å…±åŒå·¥ä½œç©ºé–“

2. **é’å‰µè³‡æºä¸­å¿ƒ**ï¼ˆå‰µæ¥­è¼”å°Žï¼‰
   - åœ°å€ï¼šä¸­å£¢å€ç’°åŒ—è·¯390è™Ÿ3æ¨“
   - é›»è©±ï¼š(03) 422-0908
   - æä¾›å‰µæ¥­è«®è©¢èˆ‡èª²ç¨‹

3. **è³‡é‡‘æ”¯æŒ**
   - å‰µæ¥­è²¸æ¬¾åˆ©æ¯è£œè²¼
   - ç¤¾æœƒä¼æ¥­å‰µæ¥­è£œåŠ©ï¼ˆç§Ÿé‡‘æœ€é«˜8,000å…ƒ/æœˆï¼Œè¨­å‚™æœ€é«˜20è¬å…ƒï¼‰

*ï¼ˆè³‡æ–™ä¾†æºï¼šã€Šæ¡ƒåœ’å¸‚æ”¿åºœé’å¹´äº‹å‹™å±€.mdã€‹ç¬¬ä¸‰ç« ã€ã€Šå¸¸è¦‹å•é¡Œå…¨é›†.mdã€‹å‰µæ¥­ç›¸é—œå•ç­”ï¼‰*

ðŸ‘‰ éœ€è¦æˆ‘å¹«æ‚¨æ•´ç†é€²é§åŸºåœ°çš„ç”³è«‹æµç¨‹å’Œæº–å‚™æ–‡ä»¶å—Žï¼Ÿ

---

### ðŸš« ç¦æ­¢äº‹é …ï¼š
- ä¸æä¾›æ³•å¾‹è§£é‡‹
- ä¸è¨Žè«–æ”¿æ²»ç«‹å ´æˆ–çˆ­è­°è­°é¡Œ
- ä¸æä¾›æ–‡ä»¶ä»¥å¤–çš„é‡‘é¡ã€åé¡ã€è©•åˆ†æ¨™æº–ã€æ ¸éŠ·æ˜Žç´°ã€æŠ•è³‡åª’åˆç­‰è³‡è¨Š
- å°æ–¼æœªè¼‰æ˜Žäº‹é …ï¼Œæ˜Žç¢ºå›žè¦†ã€Œæ–‡ä»¶æœªè¼‰æ˜Žã€ä¸¦æä¾›è¯çµ¡çª—å£'''
    )
)
USER_PROMPT = os.getenv("USER_PROMPT") or '''# æ¡ƒåœ’å¸‚æ”¿åºœé’å¹´äº‹å‹™å±€ â€” å®Œæ•´çŸ¥è­˜åº«

## ã€æ–‡ä»¶ä¸€ã€‘çµ„ç¹”æž¶æ§‹èˆ‡æ¥­å‹™ç¸½è¦½

### ä¸€ã€çµ„ç¹”æž¶æ§‹èˆ‡ä¸»ç®¡ä»‹ç´¹
æ¡ƒåœ’å¸‚é’å¹´äº‹å‹™å±€ç›´å±¬æ–¼æ¡ƒåœ’å¸‚æ”¿åºœï¼Œå¯¦è¡Œå±€é•·è² è²¬åˆ¶ï¼Œå…§éƒ¨æž¶æ§‹åŠæ ¸å¿ƒä¸»ç®¡é…ç½®å¦‚ä¸‹ï¼š

#### 1. æ ¸å¿ƒç®¡ç†å±¤
| è·å‹™       | å§“å   | ä¸»è¦è·è²¬                                   |
|------------|--------|-------------------------------------------|
| å±€é•·       | ä¾¯ä½³é½¡ | ç¶œç†å±€å‹™ï¼Œå°å…¨å±€æ¥­å‹™è² ç¸½è²¬                 |
| å‰¯å±€é•·     | æ¶‚æ·³æƒ  | å”åŠ©å±€é•·æŽ¨å‹•å„é …é’å¹´æ”¿ç­–èˆ‡è¨ˆç•«             |
| ä¸»ä»»ç§˜æ›¸   | æŽè¨“æ™º | çµ±ç±Œç§˜æ›¸å®¤æ¥­å‹™ï¼Œè² è²¬è¡Œæ”¿ç®¡ç†èˆ‡å¹•åƒšå”èª¿     |
| å°ˆé–€å§”å“¡   | æ²ˆä¸–åœ‹ | æ”¯æ´å°ˆæ¥­è¨ˆç•«ç ”æ“¬èˆ‡è·¨éƒ¨é–€å”èª¿               |

#### 2. ç§‘å®¤åŠç›´å±¬å–®ä½ä¸»ç®¡
| å–®ä½         | è·å‹™       | å§“å   | æ ¸å¿ƒè·èƒ½                                   |
|--------------|------------|--------|-------------------------------------------|
| ç¶œåˆè¦åŠƒç§‘   | ç§‘é•·       | é¦®æ€¡è | é’å¹´ç™¼å±•æ”¿ç­–è¦åŠƒèˆ‡ç£å°Ž                     |
| è·æ¶¯ç™¼å±•ç§‘   | ä»£ç†ç§‘é•·   | ç›§å´‡æ–‡ | æŽ¨å‹•é’å¹´å°±æ¥­å‰µæ¥­ç›¸é—œè¨ˆç•«                   |
| å…¬å…±åƒèˆ‡ç§‘   | ç§‘é•·       | æ–½éˆ´é‚¦ | æŽ¨å»£é’å¹´ç¤¾æœƒåƒèˆ‡åŠå¿—é¡˜æœå‹™                 |
| ç§˜æ›¸å®¤       | ä¸»ä»»       | å‚…ç€…æ¿± | ä¸»ç®¡æ–‡æ›¸æª”æ¡ˆã€å‡ºç´ç¸½å‹™ç­‰è¡Œæ”¿äº‹å‹™           |
| æœƒè¨ˆå®¤       | ä¸»ä»»       | ç¾…æ¬£çœŸ | è¾¦ç†æ­²è¨ˆã€æœƒè¨ˆåŠçµ±è¨ˆç­‰è²¡å‹™æ¥­å‹™             |
| äººäº‹å®¤       | ä¸»ä»»       | è”¡æ¯“éœ | è¾¦ç†äººäº‹ä»»å…ã€è–ªçµ¦è€ƒç¸¾ç­‰äººäº‹æ¥­å‹™           |

---

### äºŒã€å„ç§‘å®¤åŠä¸­å¿ƒæ¥­å‹™è·æŽŒ
é’å¹´äº‹å‹™å±€ä¾çµ„ç¹”è¦ç¨‹è¨­ç«‹"ä¸‰ç§‘ä¸€å®¤"ï¼Œä¸¦ä¸‹è¨­ç¤¾æœƒä¼æ¥­ä¸­å¿ƒï¼Œå½¢æˆè¦†è“‹é’å¹´ç™¼å±•å…¨é ˜åŸŸçš„æ¥­å‹™é«”ç³»ï¼š

#### 1. ç¶œåˆè¦åŠƒç§‘
- **æ ¸å¿ƒè·èƒ½**ï¼šé’å¹´ç™¼å±•æ”¿ç­–ç ”è¨‚èˆ‡ç¶œåˆè¦åŠƒ
- **é‡é»žå·¥ä½œ**ï¼š
  1. ç·¨åˆ¶å¹´åº¦é’å¹´æ”¿ç­–ç™½çš®æ›¸
  2. æŽ¨å‹•é’å¹´å¤šå…ƒå­¸ç¿’èˆ‡ç¤¾åœ˜åƒèˆ‡
  3. é–‹å±•é’å¹´è¨­è¨ˆèˆ‡è—æ–‡ç™¼å±•åŸ¹è‚²
  4. çµ„ç¹”é’å¹´åœ‹éš›äº¤æµåŠé«”é©—å­¸ç¿’æ´»å‹•

#### 2. è·æ¶¯ç™¼å±•ç§‘
- **æ ¸å¿ƒè·èƒ½**ï¼šé’å¹´å°±æ¥­å‰µæ¥­æ”¯æŒèˆ‡ç”Ÿæ¶¯ç™¼å±•å¼•å°Ž
- **é‡é»žå·¥ä½œ**ï¼š
  1. æä¾›é’å¹´å‰µæ¥­è¼”å°Žèˆ‡å°±æ¥­è¦‹ç¿’æœå‹™
  2. èˆ‰è¾¦è·æ¶¯è¦åŠƒè¬›åº§èˆ‡åŸ¹è¨“
  3. é–‹å±•å‰µæ–°å‰µæ¥­ç«¶è³½ç­‰èƒ½åŠ›æå‡æ´»å‹•
  4. æŽ¨å‹•é’å¹´è·å ´é«”é©—é …ç›®

#### 3. å…¬å…±åƒèˆ‡ç§‘
- **æ ¸å¿ƒè·èƒ½**ï¼šé’å¹´ç¤¾æœƒåƒèˆ‡èƒ½åŠ›åŸ¹è‚²èˆ‡å¯¦è¸æŽ¨å‹•
- **é‡é»žå·¥ä½œ**ï¼š
  1. åŸ¹è‚²é’å¹´å…¬å…±è­°é¡Œåƒèˆ‡æ„è­˜èˆ‡èƒ½åŠ›
  2. çµ„ç¹”å¿—å·¥åŸ¹è¨“åŠå¿—é¡˜æœå‹™è¨ˆç•«
  3. è¼”å°Žé’å¹´æˆç«‹åŠé‹ç‡Ÿç¤¾åœ˜
  4. æ­å»ºé’å¹´æ”¿ç­–åƒèˆ‡æºé€šå¹³å°

#### 4. ç§˜æ›¸å®¤
- **æ ¸å¿ƒè·èƒ½**ï¼šå±€å…§è¡Œæ”¿ç®¡ç†èˆ‡ç¶œåˆæœå‹™
- **é‡é»žå·¥ä½œ**ï¼š
  1. æ–‡æ›¸æª”æ¡ˆç®¡ç†ã€å‡ºç´åº¶å‹™åŠè²¡ç”¢ç®¡ç†
  2. è³‡è¨Šç³»çµ±é‹ç¶­èˆ‡æ•¸æ“šç®¡ç†
  3. æ³•åˆ¶ç ”è€ƒèˆ‡å…¬é—œå®£å°Ž
  4. çµ±ç±Œä¸å±¬å„ç§‘å®¤çš„å…¶ä»–è¡Œæ”¿äº‹å‹™

#### 5. ç¤¾æœƒä¼æ¥­ä¸­å¿ƒ
- **æ ¸å¿ƒè·èƒ½**ï¼šé’å¹´ç¤¾æœƒä¼æ¥­ç™¼å±•å°ˆé …æŽ¨å‹•
- **é‡é»žå·¥ä½œ**ï¼š
  1. èˆ‰è¾¦æ¡ƒåœ’ç¤¾ä¼å‰µæ¥­ç«¶è³½ï¼ˆå°¤åŠªæ–¯çŽï¼‰
  2. æä¾›ç¤¾æœƒä¼æ¥­å‰µæ¥­è¼”å°Žèˆ‡è³‡æºå°æŽ¥
  3. ä¸»å°Žç¤¾ä¼å‰µæ¥­è£œåŠ©è¨ˆç•«ï¼ˆç§Ÿé‡‘ã€è¨­å‚™è£œè²¼ç­‰ï¼‰
  4. ç™¼æŽ˜é’å¹´å‰µæ–°æ½›åŠ›ï¼Œæ“´å¤§ç¤¾æœƒä¼æ¥­å½±éŸ¿åŠ›

---

### ä¸‰ã€è½„ä¸‹å„åŸºåœ°èˆ‡è³‡æºä¸­å¿ƒ
é’å¹´äº‹å‹™å±€æ§‹å»ºäº†"å¯¦é«”åŸºåœ°+ç·šä¸Šå¹³å°"çš„ç«‹é«”åŒ–è³‡æºæœå‹™ç¶²çµ¡ï¼Œç‚ºé’å¹´æä¾›å…¨æ–¹ä½æ”¯æŒï¼š

#### 1. é’å¹´å‰µæ¥­åŸºåœ°ç¾¤ï¼ˆTYCå‰µæ–°å‰µæ¥­åŸºåœ°ï¼‰
- **æ ¸å¿ƒæ“šé»ž**ï¼šé’å‰µæŒ‡æ®éƒ¨ã€å®‰æ±é’å‰µåŸºåœ°ã€æ–°æ˜Žé’å‰µåŸºåœ°
- **æœå‹™å…§å®¹**ï¼š
  - ç©ºé–“æ”¯æŒï¼šç¨ç«‹è¾¦å…¬å®¤ã€å…±åŒå·¥ä½œç©ºé–“ã€è™›æ“¬é€²é§æœå‹™
  - èƒ½åŠ›åŸ¹è‚²ï¼šå‰µæ¥­ä¸»é¡Œèª²ç¨‹ã€æ•¸ä½äººæ‰åŸ¹è‚²ã€ç§‘æ™®æ•™è‚²ã€å‰µå®¢å¯¦ä½œ
  - è³‡æºå°æŽ¥ï¼šå‰µæ¥­äº¤æµæ´»å‹•ã€å•†æ©Ÿåª’åˆå¹³å°
- **è³‡è¨Šç²å–**ï¼š"æ¡ƒåœ’é’å‰µäº‹"Facebookå°ˆé ã€é’å¹´äº‹å‹™å±€å®˜ç¶²

#### 2. é’å‰µè³‡æºä¸­å¿ƒï¼ˆå‰µæ¥­è³‡æºç¶²ï¼‰
- **ç·šä¸Šå¹³å°**ï¼šæ¡ƒåœ’TYCå‰µæ–°å‰µæ¥­è³‡æºç¶²ï¼ˆå‰µæ¥­ä¸€ç«™å¼å¹³å°ï¼‰
- **æ ¸å¿ƒæœå‹™**ï¼š
  1. å‰µæ¥­è«®è©¢è¼”å°Žèˆ‡èª²ç¨‹å…¬å‘Š
  2. å‰µæ¥­åœ˜éšŠç²¾æº–åª’åˆ
  3. è³‡é‡‘å°æŽ¥èˆ‡æ”¿ç­–è§£è®€
- **æœå‹™æˆæžœ**ï¼šç´¯è¨ˆè¼”å°Ž300+é’å¹´å‰µæ¥­åœ˜éšŠï¼Œåª’åˆå•†æ©Ÿ700+ä»¶ï¼Œå”åŠ©ç²å–å‰µæ¥­è³‡é‡‘è¶…3å„„å…ƒï¼Œæä¾›è«®è©¢1700+äººæ¬¡

#### 3. é’å¹´å¿—å·¥è³‡æºä¸­å¿ƒ
- **æœå‹™å®šä½**ï¼šå¿—é¡˜æœå‹™è³‡æºæ•´åˆèˆ‡èƒ½åŠ›åŸ¹è‚²å¹³å°
- **æ ¸å¿ƒæœå‹™**ï¼š
  1. å¿—å·¥æ´»å‹•è³‡è¨Šç™¼å¸ƒèˆ‡å ±å
  2. å¿—å·¥å°ˆæ¥­åŸ¹è¨“èª²ç¨‹
  3. å¿—é¡˜æœå‹™æ™‚é•·è¨˜éŒ„èˆ‡èªè­‰
  4. åœ‹éš›å¿—å·¥æœå‹™éšŠçµ„å»ºèˆ‡æ”¯æŒ
- **ç‰¹è‰²é …ç›®**ï¼šå¯’æš‘å‡è¿”é„‰æœå‹™ç‡ŸéšŠã€åœ‹éš›å¿—å·¥äº¤æµã€å¤§åž‹æ´»å‹•å¿—å·¥æ‹›å‹Ÿ

#### 4. æ¡ƒåœ’å¤šå…ƒé’å°‘å¹´æ´»å‹•ç©ºé–“
| ç©ºé–“åç¨±                     | å®šä½                     | æœå‹™å…§å®¹                                   |
|------------------------------|--------------------------|-------------------------------------------|
| æ¡ƒåœ’è¨­è¨ˆåº«                   | è¨­è¨ˆåŠæ–‡å‰µé’å¹´äº¤æµæ“šé»ž   | å‰µæ„äº¤æµã€ä½œå“å±•ç¤ºã€æŠ€èƒ½å…±äº«               |
| æ¡ƒåœ’é’å¹´é«”é©—å­¸ç¿’åœ’å€         | æˆ¶å¤–é«”é©—åŸºåœ°             | æˆ¶å¤–æ•™è‚²ã€åœ˜éšŠåŸ¹è¨“ã€è‡ªç„¶é«”é©—               |
| åŒ—å€é’å°‘å¹´æ´»å‹•ä¸­å¿ƒâ€“æ¡ƒæ¼¾é¤¨     | ç¶œåˆæ´»å‹•ç©ºé–“             | å¤šå…ƒä¸»é¡Œæ´»å‹•ã€ç¤¾åœ˜èšæœƒã€åŸ¹è¨“ç ”è¨Ž           |
| å¤šå…ƒä½¿ç”¨ç©ºé–“                 | é–’ç½®ç©ºé–“å†åˆ©ç”¨           | ä¾›é’å¹´ç¤¾åœ˜ç”³è«‹çŸ­æœŸä½¿ç”¨                     |
| æ ¡åœ’ç¤¾åœ˜è³‡æºä¸­å¿ƒ             | æ ¡ç¤¾å°æŽ¥å¹³å°             | å™¨æç§Ÿå€Ÿã€å ´åœ°è³‡è¨Šã€ç¤¾å€éˆæŽ¥               |

#### 5. é’å¹´eè¦–ç•Œ
- **å¹³å°å®šä½**ï¼šç·šä¸Šè³‡æºæ•´åˆå…¥å£
- **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  1. ä¸²è¯å±€å±¬å„ç¶²ç«™ï¼ˆå‰µæ¥­è³‡æºç¶²ã€è¨­è¨ˆåº«ç­‰ï¼‰
  2. æ•´åˆç¤¾ç¾¤å¸³è™Ÿï¼ˆFacebookã€Instagramã€LINEç­‰ï¼‰
  3. åŒ¯é›†"æ¡ƒé’åƒä¸€å’–"å°ˆé ã€Youthingså½±éŸ³é »é“å…§å®¹
  4. ç™¼å¸ƒæ´»å‹•å½±éŸ³ã€æˆæžœå ±å°ŽåŠç¦åˆ©è³‡è¨Š

---

### å››ã€é’å¹´è£œåŠ©èˆ‡æœå‹™è¨ˆç•«
é‡å°é’å¹´å¤šå…ƒç™¼å±•éœ€æ±‚ï¼ŒæŽ¨å‡ºä¸ƒå¤§é¡žå°ˆé …è£œåŠ©èˆ‡æœå‹™æ–¹æ¡ˆï¼š

#### 1. é’å¹´åƒèˆ‡å¤šå…ƒæ–‡åŒ–è£œåŠ©
- è£œåŠ©å°è±¡ï¼šè¨­ç±æ¡ƒåœ’15ï½ž35æ­²é’å¹´ã€æœ¬å¸‚åœ˜é«”ã€å­¸æ ¡ç­‰
- è£œåŠ©é¡åº¦ï¼šæ¯ä»¶æœ€é«˜æ–°å°å¹£2è¬å…ƒ
- ç”³è«‹è¦æ±‚ï¼šæ´»å‹•å‰20æ—¥æå‡ºç”³è«‹
- é©ç”¨ç¯„åœï¼šè—æ–‡è¡¨æ¼”ã€æ–‡åŒ–äº¤æµç­‰ä¿ƒé€²é’å¹´å‡èšåŠ›çš„æ´»å‹•

#### 2. é’å¹´åƒèˆ‡åœ‹éš›äº‹å‹™è£œåŠ©
- è£œåŠ©å°è±¡ï¼šè¨­ç±/å°±å­¸/å°±æ¥­æ–¼æ¡ƒåœ’çš„15ï½ž35æ­²é’å¹´
- è£œåŠ©ç¯„åœï¼šå‡ºåœ‹åƒèˆ‡ç«¶è³½ã€å±•æ¼”ã€å¤§åž‹æœƒè­°çš„æ©Ÿç¥¨ã€é£Ÿå®¿ç­‰è²»ç”¨
- è£œåŠ©é¡åº¦ï¼šæ¯æ¡ˆæœ€é«˜2è¬å…ƒ
- ç”³è«‹è¦æ±‚ï¼šå‡ºåœ‹å‰20æ—¥æäº¤è¨ˆç•«æ›¸

#### 3. é’å¹´ç¤¾æœƒåƒèˆ‡è£œåŠ©
- è£œåŠ©å°è±¡ï¼šæœ¬å¸‚ç«‹æ¡ˆåœ˜é«”ã€å­¸æ ¡å–®ä½æˆ–6äººä»¥ä¸Šé’å¹´åœ˜éšŠï¼ˆ15ï½ž35æ­²ï¼‰
- è£œåŠ©ç¯„åœï¼šå…¬å…±æœå‹™ã€åé„‰é—œæ‡·ã€ç¤¾å€ç‡Ÿé€ ç­‰é …ç›®
- è£œåŠ©é¡åº¦ï¼šæœ€é«˜2è¬å…ƒ

#### 4. é’å¹´æŠ•å…¥æ°¸çºŒç™¼å±•è¡Œå‹•è¨ˆç•«
- æ‹›å‹Ÿçµ„åˆ¥ï¼šå‰µæ–°è¨ˆç•«çµ„ã€é ˜èˆªè¨ˆç•«çµ„
- æ”¯æŒå…§å®¹ï¼šè¨ˆç•«è£œåŠ©ã€å°ˆæ¥­è¼”å°Žã€æˆæžœç™¼è¡¨æ©Ÿæœƒ
- ç”³è«‹æ¢ä»¶ï¼šé‡å°åœ¨åœ°ç¤¾å€æ°¸çºŒè­°é¡Œæå‡ºä¸­é•·æœå‹™æ–¹æ¡ˆçš„é’å¹´åœ˜éšŠ

#### 5. é’å¹´åœ‹éš›å¿—å·¥æœå‹™éšŠè£œåŠ©
- ç”³è«‹æ¢ä»¶ï¼š6äººä»¥ä¸Šåœ˜éšŠï¼Œæˆå“¡éœ€è¨­ç±/å°±å­¸/å°±æ¥­æ–¼æ¡ƒåœ’
- è£œåŠ©é¡åº¦ï¼šä¸€èˆ¬æ–¹æ¡ˆæœ€é«˜10è¬å…ƒï¼›æ ¸å®šå¿—å·¥é‹ç”¨å–®ä½æœ€é«˜30è¬å…ƒ

#### 6. ç¤¾æœƒä¼æ¥­å‰µæ¥­è£œåŠ©
- è£œåŠ©é¡žåž‹ï¼š
  - ç§Ÿé‡‘è£œåŠ©ï¼šæ¯æœˆæœ€é«˜8,000å…ƒï¼Œæœ€é•·2å¹´
  - è¨­å‚™è£œåŠ©ï¼šæœ€é«˜20è¬å…ƒï¼ˆä¸å«æ¶ˆè€—å“ï¼‰
- é©ç”¨ç¯„åœï¼šèšç„¦å¼±å‹¢é—œæ‡·ã€é•·ç…§ã€åœ¨åœ°å‰µç”Ÿã€ç’°ä¿ã€å…¬å¹³è²¿æ˜“ç­‰é ˜åŸŸçš„ç¤¾ä¼

#### 7. é’å¹´è·æ¶¯ç™¼å±•åŠå‰µæ¥­æ´»å‹•è£œåŠ©
- è£œåŠ©å°è±¡ï¼šå­¸æ ¡ã€ç ”ç©¶æ©Ÿæ§‹ã€æ³•äººåœ˜é«”ã€å‰µæ¥­åŸºåœ°åœ˜éšŠ
- è£œåŠ©é¡žåž‹ï¼šæ•™è‚²èª²ç¨‹ã€å·¥ä½œåŠã€è«–å£‡ã€åª’åˆæ´»å‹•ã€å‰µæ¥­ç«¶è³½ç­‰

---

### äº”ã€è¯çµ¡è³‡è¨Šèˆ‡æœå‹™çª—å£
- **è¾¦å…¬åœ°å€**ï¼š320029 æ¡ƒåœ’å¸‚ä¸­å£¢å€ç’°åŒ—è·¯390è™Ÿï¼ˆä¸­å£¢å€å…¬æ‰€æ—ï¼‰
- **ç¸½æ©Ÿé›»è©±**ï¼š(03) 422-5205
- **å„å–®ä½åˆ†æ©Ÿ**ï¼š
  - ç¶œåˆè¦åŠƒç§‘ï¼š7001ï½ž7017
  - è·æ¶¯ç™¼å±•ç§‘ï¼š5001ï½ž5014
  - å…¬å…±åƒèˆ‡ç§‘ï¼š6001ï½ž6012ã€8010ï½ž8011
  - ç§˜æ›¸å®¤ï¼š3001ï½ž3014
  - æœƒè¨ˆå®¤ï¼š2005ï½ž2006
  - äººäº‹å®¤ï¼š2001ã€2008ï½ž2009
  - ç¤¾æœƒä¼æ¥­ä¸­å¿ƒï¼ˆå¹³éŽ®é¤¨ï¼‰ï¼š8010
- **ä¾¿æ°‘æœå‹™**ï¼š
  - å¸‚æ”¿æœå‹™å°ˆç·šï¼š1999ï¼ˆå¤–ç¸£å¸‚è«‹æ’¥03-218-9000ï¼‰
  - ç·šä¸Šæ™ºèƒ½å®¢æœã€é›»å­éƒµä»¶è«®è©¢

---

### å…­ã€æœ€æ–°å…¬å‘Šèˆ‡è¨ˆç•«æ›´æ–°
1. 114å¹´åº¦"é’å¹´æ°¸çºŒç™¼å±•è¡Œå‹•è¨ˆç•«"é›™çµ„æ‹›å‹Ÿè‡³2æœˆ10æ—¥æ­¢
2. é’å¹´åœ‹éš›å¿—å·¥æœå‹™éšŠå¯’æœŸè£œåŠ©è¨ˆç•«å³æ—¥èµ·è‡³11æœˆ20æ—¥å—ç†
3. ç¬¬åå±†"å°¤åŠªæ–¯çŽ"ç¤¾ä¼ç«¶è³½ç¸½çŽé‡‘æå‡è‡³60è¬å…ƒï¼Œæ–°å¢ž"ç¤¾æœƒå½±éŸ¿åŠ›çµ„"
4. å¹´åº¦æ–½æ”¿è¨ˆç•«ã€å ±å‘Šèˆ‡æˆæžœå°ˆåˆŠå‡æ–¼å®˜ç¶²å…¬é–‹

---

## ã€æ–‡ä»¶äºŒã€‘å¸¸è¦‹å•é¡Œå…¨é›†

### ï¼ˆä¸€ï¼‰å‰µæ¥­èˆ‡é’å‰µåŸºåœ°ç›¸é—œ

1. **å•**ï¼šé’å¹´å±€çš„é’å‰µåŸºåœ°æœ‰è¾¦ç†ç›¸é—œèª²ç¨‹å—Žï¼Ÿ
   **ç­”**ï¼šæ¡ƒåœ’å¸‚æ”¿åºœé’å¹´äº‹å‹™å±€è¨­æœ‰é’å¹´å‰µæ¥­åŸºåœ°ï¼ˆé’å‰µæŒ‡æ®éƒ¨ã€å®‰æ±é’å‰µåŸºåœ°ã€æ–°æ˜Žé’å‰µåŸºåœ°ï¼‰ï¼Œä¸å®šæ™‚èˆ‰è¾¦å‰µæ¥­ä¸»é¡Œå¼èª²ç¨‹ã€æ•¸ä½äººæ‰åŸ¹è‚²èª²ç¨‹ã€ç§‘æ™®æ•™è‚²èª²ç¨‹ã€å‰µå®¢å¯¦ä½œèª²ç¨‹ã€å‰µæ–°å‰µæ¥­äº¤æµèšæœƒç­‰ï¼Œæ¶µè“‹å‰µæ¥­æ ¸å¿ƒæŠ€èƒ½ã€æ•¸ä½å·¥å…·æ‡‰ç”¨ã€å¾®åž‹å‰µæ¥­å¯¦å‹™ã€‚æ´»å‹•è³‡è¨Šå¯è‡³"æ¡ƒåœ’é’å‰µäº‹"ç²‰çµ²å°ˆé æˆ–é’å¹´äº‹å‹™å±€å®˜ç¶²æŸ¥è©¢ã€‚
   **ä¸Šç‰ˆæ—¥æœŸ**ï¼š114-09-30

2. **å•**ï¼šæˆ‘å‰›ç•¢æ¥­ï¼Œæœ‰å’Œå¤§å­¸åŒå­¸å…±åŒå‰µç«‹ä¸€å€‹é’å‰µåœ˜éšŠï¼Œæƒ³é€²é§é’å‰µåŸºåœ°ï¼Œè«‹å•è©²å¦‚ä½•åŠ å…¥å‘¢ï¼Ÿ
   **ç­”**ï¼šé’å¹´å±€æ‰€å±¬åŸºåœ°ï¼ˆé’å‰µæŒ‡æ®éƒ¨ã€å®‰æ±åŸºåœ°ï¼‰æ¯åŠå¹´è¾¦ç†ä¸€æ¬¡é€²é§å¯©æŸ¥ï¼Œæ‹›å‹Ÿå…¬å‘Šè«‹è¦‹"TYCå‰µæ¥­è³‡æºç¶²"ï¼ˆhttps://tyc.tycg.gov.tw/ï¼‰æˆ–"é’å‰µäº‹"Facebookå°ˆé ã€‚
   **ä¸Šç‰ˆæ—¥æœŸ**ï¼š114-08-07

3. **å•**ï¼šæˆ‘æ˜¯å‰›ç•¢æ¥­å‡ºç¤¾æœƒçš„é’å¹´ï¼Œè«‹å•ä½ å€‘æ˜¯å¦æœ‰å‰µæ¥­è³‡æºèƒ½é‹ç”¨ï¼Ÿï¼ˆå¦‚å‰µæ¥­åŸºåœ°ç­‰ï¼‰
   **ç­”**ï¼šé’å¹´äº‹å‹™å±€æä¾›ä¸‰å¤§æ ¸å¿ƒè³‡æºï¼šâ‘ é’å‰µæŒ‡æ®éƒ¨ï¼ˆä¸­å£¢å€ï¼Œé›»è©±03-4279796ï¼‰ï¼›â‘¡å®‰æ±é’å¹´å‰µæ¥­åŸºåœ°ï¼ˆæ¡ƒåœ’å€ï¼Œé›»è©±03-3355530ï¼‰ï¼›â‘¢é’å‰µè³‡æºä¸­å¿ƒï¼ˆå‰µæ¥­è«®è©¢èˆ‡èª²ç¨‹ï¼Œç¶²å€http://tyc.tycg.gov.tw/ï¼Œé›»è©±03-4220908ï¼‰ã€‚
   **ä¸Šç‰ˆæ—¥æœŸ**ï¼š114-08-07

4. **å•**ï¼šé’å‰µæŒ‡æ®éƒ¨æœ‰ä»€éº¼æ¨£çš„è¨­æ–½èˆ‡è¨­å‚™å‘¢ï¼Ÿè©²å¦‚ä½•ç”³è«‹ä½¿ç”¨å‘¢ï¼Ÿ
   **ç­”**ï¼šé’å‰µæŒ‡æ®éƒ¨è¨­æœ‰ç¨ç«‹è¾¦å…¬å®¤ã€å…±åŒå·¥ä½œç©ºé–“ã€æœƒè­°å®¤ã€å¤šåŠŸèƒ½æ•™å®¤èˆ‡å‰µå®¢ç©ºé–“ï¼ˆå«é›·å°„åˆ‡å‰²æ©Ÿã€3Dåˆ—å°æ©Ÿç­‰è¨­å‚™ï¼‰ï¼Œå¯æä¾›ä¸€èˆ¬å¸‚æ°‘ç§Ÿå€Ÿã€‚ç§Ÿå€Ÿç”³è«‹è«‹è‡³æ¡ƒåœ’å‰µæ–°å‰µæ¥­è³‡æºç¶²ï¼ˆhttps://tyc.tycg.gov.tw/ï¼‰è¾¦ç†ã€‚
   **ä¸Šç‰ˆæ—¥æœŸ**ï¼š114-08-11

5. **å•**ï¼šæˆ‘å‰›å‰µæ¥­ï¼Œç›®å‰æœ‰è³‡é‡‘å£“åŠ›ï¼Œè«‹å•æ˜¯å¦æœ‰è³‡é‡‘çš„å”åŠ©å‘¢ï¼Ÿ
   **ç­”**ï¼šé’å¹´å¯ç”³è«‹"é’å¹´å‰µæ¥­åŠä¸­å°ä¼æ¥­ä¿¡ç”¨ä¿è­‰èžè³‡è²¸æ¬¾å°ˆæ¡ˆ""åœ°æ–¹åž‹SBIRè¨ˆç•«"ç­‰æ–¹æ¡ˆï¼Œå¦å¯è‡³é’å‰µè³‡æºä¸­å¿ƒï¼ˆåœ°å€ï¼šæ¡ƒåœ’å¸‚ä¸­å£¢å€ç’°åŒ—è·¯390è™Ÿ3æ¨“ï¼Œé›»è©±(03)422-0908ï¼‰è«®è©¢å‰µæ¥­è¼”å°Žã€‚
   **ä¸Šç‰ˆæ—¥æœŸ**ï¼š114-09-05

### ï¼ˆäºŒï¼‰è£œåŠ©ç”³è«‹ç›¸é—œ

1. **å•**ï¼šæˆ‘æ˜¯â—‹â—‹åœ˜é«”è² è²¬äººï¼Œæƒ³èˆ‰è¾¦å‰µæ¥­æ´»å‹•ï¼Œè«‹å•æ˜¯å¦æœ‰è£œåŠ©å¯ä»¥ç”³è«‹å‘¢ï¼Ÿ
   **ç­”**ï¼šå¯ä¾"é’å¹´è·æ¶¯ç™¼å±•åŠå‰µæ¥­æ´»å‹•è£œåŠ©ä½œæ¥­è¦é»ž"ç”³è«‹ï¼Œè£œåŠ©å°è±¡åŒ…æ‹¬å„ç´šå­¸æ ¡åŠç ”ç©¶æ©Ÿæ§‹ã€åˆæ³•ç«‹æ¡ˆçš„åœ˜é«”/æ³•äºº/å·¥æœƒ/åˆä½œç¤¾ã€é’å¹´å±€èªå®šçš„å‰µæ¥­åŸºåœ°é€²é§åœ˜éšŠï¼›è£œåŠ©æ´»å‹•é¡žåž‹å«æ•™è‚²èª²ç¨‹ã€è«–å£‡ã€ææ¡ˆç«¶è³½ã€åª’åˆå±•è¦½ç­‰ã€‚æ´½è©¢é›»è©±ï¼š03-4225205åˆ†æ©Ÿ5010ï¼ˆçŽ‹å°å§ï¼‰ã€‚
   **ä¸Šç‰ˆæ—¥æœŸ**ï¼š114-09-30

2. **å•**ï¼šæˆ‘æƒ³å‡ºåœ‹åƒåŠ æ¯”è³½ã€å±•æ¼”æˆ–å¤§åž‹åœ‹éš›æœƒè­°ï¼Œè«‹å•é’å¹´äº‹å‹™å±€æœ‰æä¾›ç›¸é—œè£œåŠ©å—Žï¼Ÿ
   **ç­”**ï¼šå¯ä¾"æ¡ƒåœ’å¸‚æ”¿åºœè£œåŠ©é’å¹´åƒèˆ‡åœ‹éš›äº‹å‹™ä½œæ¥­è¦é»ž"ç”³è«‹ï¼Œè£œåŠ©å°è±¡ç‚ºè¨­ç±æˆ–å°±å­¸æ–¼æ¡ƒåœ’å¸‚çš„15â€“35æ­²é’å¹´ï¼Œæœ€é«˜è£œåŠ©é‡‘é¡å¯é”20è¬å…ƒã€‚
   **ä¸Šç‰ˆæ—¥æœŸ**ï¼š114-08-20

3. **å•**ï¼šæˆ‘æƒ³èˆ‰è¾¦â—‹â—‹â—‹è¡¨æ¼”æ´»å‹•ï¼Œè«‹å•é’å¹´äº‹å‹™å±€æœ‰æä¾›è£œåŠ©å—Žï¼Ÿ
   **ç­”**ï¼šå¯ä¾"æ¡ƒåœ’å¸‚æ”¿åºœä¿ƒé€²é’å¹´åƒèˆ‡å¤šå…ƒæ–‡åŒ–è£œåŠ©ä½œæ¥­è¦é»ž"ç”³è«‹ï¼Œé¼“å‹µé’å¹´èˆ‰è¾¦å¤šå…ƒæ–‡åŒ–ã€è¡¨æ¼”è—è¡“ã€æ–‡å‰µè¨­è¨ˆç­‰æ´»å‹•ï¼Œæœ€é«˜è£œåŠ©é¡å¯é”10è¬å…ƒã€‚
   **ä¸Šç‰ˆæ—¥æœŸ**ï¼š114-08-20

4. **å•**ï¼šæˆ‘æ˜¯â—‹â—‹é«˜ä¸­å­¸ç”Ÿï¼Œæƒ³å’ŒåŒå­¸8äººæ–¼æš‘å‡æœŸé–“ï¼Œåˆ°åé åœ°å€åšé—œæ‡·æœå‹™ï¼Œè«‹å•æœ‰ç›¸é—œè£œåŠ©èƒ½æä¾›ç”³è«‹å—Žï¼Ÿ
   **ç­”**ï¼šå¯ä¾"æ¡ƒåœ’å¸‚æ”¿åºœä¿ƒé€²é’å¹´ç¤¾æœƒåƒèˆ‡è£œåŠ©ä½œæ¥­è¦é»ž"ç”³è«‹ï¼Œè£œåŠ©é …ç›®åŒ…æ‹¬å…¬å…±è­°é¡Œæ´»å‹•ã€åœ‹å…§å¿—å·¥æœå‹™ã€åœ‹éš›å¿—å·¥æœå‹™ç­‰ã€‚è¯ç¹«ï¼šè¨±å…ˆç”Ÿ03-422-5205 #6005ã€‚
   **ä¸Šç‰ˆæ—¥æœŸ**ï¼š114-08-20

### ï¼ˆä¸‰ï¼‰ç¤¾æœƒåƒèˆ‡èˆ‡è·æ¶¯ç›¸é—œ

1. **å•**ï¼šæˆ‘å€‘æ˜¯ä¸€ç¾¤æœ‰æœå‹™ç†±å¿±çš„åœ¨åœ°é’å¹´ï¼Œæƒ³è®“æ¡ƒåœ’æ›´å¥½ï¼Œè«‹å•èƒ½å”åŠ©æˆ‘å€‘å—Žï¼Ÿ
   **ç­”**ï¼šç¬¦åˆ"é’å¹´æŠ•å…¥æ°¸çºŒç™¼å±•è¡Œå‹•è¨ˆç•«"æ¢ä»¶å¯ç”³è«‹åƒèˆ‡ï¼Œè©²è¨ˆç•«é¼“å‹µ15â€“45æ­²é’å¹´çµ„éšŠæŽ¨å‹•åœ°æ–¹å‰µç”Ÿã€ç¤¾å€ç‡Ÿé€ ã€æ–‡åŒ–ä¿å­˜ç­‰è¡Œå‹•ï¼Œå¯è¿½è¹¤"é’å¹´äº‹å‹™å±€"èˆ‡"æ¡ƒé’åƒä¸€å’–"Facebookå°ˆé æŽŒæ¡å¾µä»¶è³‡è¨Šã€‚
   **ä¸Šç‰ˆæ—¥æœŸ**ï¼š114-08-01

2. **å•**ï¼šæˆ‘æ˜¯â—‹â—‹å¤§å­¸å­¸ç”Ÿï¼Œå’ŒåŒå­¸æƒ³åˆ©ç”¨å¯’æš‘å‡æœŸé–“åƒåŠ å¿—å·¥æœå‹™ï¼Œè«‹å•æœ‰ç›¸é—œè¨Šæ¯å—Žï¼Ÿ
   **ç­”**ï¼šå¯æ´½"é’å¹´å¿—å·¥è³‡æºä¸­å¿ƒ"ï¼Œæä¾›å¿—å·¥åŸ¹è¨“ã€æ™‚æ•¸è­‰æ˜Žèˆ‡æ´»å‹•è£œåŠ©ã€‚è¯ç¹«é›»è©±ï¼š03-4225205åˆ†æ©Ÿ6004ã€6026ï¼›Emailï¼štaoyuanyvc@gmail.comã€‚
   **ä¸Šç‰ˆæ—¥æœŸ**ï¼š114-08-01

3. **å•**ï¼šæ˜¯å¦æœ‰é‡å°é’å¹´çš„è·å ´é«”é©—è¨ˆç•«ï¼Ÿ
   **ç­”**ï¼šé’å¹´å±€æŽ¨å‹•"æ¡ƒåœ’é’å¹´è·å ´é«”é©—è¨ˆç•«"ï¼Œé‚€15â€“30æ­²é’å¹´åƒèˆ‡å…¨å°å„ªè³ªä¼æ¥­è·å ´é«”é©—ï¼Œäº†è§£ç”¢æ¥­è¶¨å‹¢ã€å¼·åŒ–è·èƒ½ç«¶çˆ­åŠ›ã€‚æ›´å¤šè³‡è¨Šå¯æœå°‹"æ¡ƒåœ’å¸‚æ”¿åºœé’å¹´äº‹å‹™å±€"Facebookç²‰çµ²å°ˆé ã€‚
   **ä¸Šç‰ˆæ—¥æœŸ**ï¼š114-08-07

---

## ã€æ–‡ä»¶ä¸‰ã€‘7å¤§ä¸»é¡Œå•ç­”ç²¾é¸

### A1 å‰µæ¥­è³‡æºä¸»é¡Œ

**Q1ï¼šæ¡ƒåœ’å¸‚é’å¹´æœ‰å‰µæ¥­è³‡æºå¯ä»¥ä½¿ç”¨å—Žï¼Ÿ**
Aï¼šæœ‰ï¼Œæ ¸å¿ƒè³‡æºåŒ…æ‹¬ï¼š
â‘  é’å‰µåŸºåœ°ï¼ˆé’å‰µæŒ‡æ®éƒ¨ã€å®‰æ±é’å‰µåŸºåœ°ã€æ–°æ˜Žé’å‰µåŸºåœ°ï¼‰
â‘¡ é’å‰µè³‡æºä¸­å¿ƒï¼ˆå‰µæ¥­è«®è©¢+èª²ç¨‹æœå‹™ï¼‰
â‘¢ å‰µæ¥­è³‡é‡‘æ”¯æŒï¼ˆä¿¡ä¿èžè³‡å°ˆæ¡ˆã€SBIRè¨ˆç•«ã€ç¤¾ä¼è£œåŠ©ï¼‰

**Q2ï¼šå‰›å‡ºç¤¾æœƒè¦å‰µæ¥­æœ‰è£œåŠ©å—Žï¼Ÿ**
Aï¼šæœ‰ï¼Œå¯ç”³è«‹ä¸‰é¡žè£œåŠ©ï¼š
â‘  ç¤¾æœƒä¼æ¥­å‰µæ¥­è£œåŠ©ï¼ˆç§Ÿé‡‘è£œè²¼/è¨­å‚™è£œè²¼ï¼‰
â‘¡ é’å¹´è·æ¶¯ç™¼å±•åŠå‰µæ¥­æ´»å‹•è£œåŠ©ï¼ˆæ´»å‹•ç¶“è²»ï¼‰
â‘¢ å‰µæ¥­è²¸æ¬¾åˆ©æ¯è£œè²¼ï¼ˆä¿¡ä¿èžè³‡å°ˆæ¡ˆé…å¥—ï¼‰

**Q3ï¼šé’å¹´æƒ³å‰µæ¥­å¯ä»¥åŽ»å“ªè£¡è«®è©¢ï¼Ÿ**
Aï¼šé¦–é¸**é’å‰µè³‡æºä¸­å¿ƒ**ï¼š
- åœ°å€ï¼šæ¡ƒåœ’å¸‚ä¸­å£¢å€ç’°åŒ—è·¯390è™Ÿ3æ¨“
- é›»è©±ï¼š(03)422-0908
- ç·šä¸Šè«®è©¢ï¼šæ¡ƒåœ’TYCå‰µæ¥­è³‡æºç¶²ï¼ˆhttp://tyc.tycg.gov.tw/ï¼‰

### A2 é€²é§åŸºåœ°ä¸»é¡Œ

**Q11ï¼šé’å‰µåŸºåœ°çš„ç”³è«‹æ¢ä»¶æ˜¯ä»€éº¼ï¼Ÿ**
Aï¼šâ‘  å¹´é½¡è¦æ±‚ï¼š35æ­²ä»¥ä¸‹ï¼ˆåœ˜éšŠæ ¸å¿ƒæˆå“¡ï¼‰
   â‘¡ å±¬åœ°è¦æ±‚ï¼šå…¬å¸ç™»è¨˜åœ°å€ç‚ºæ¡ƒåœ’å¸‚
   â‘¢ å¯©æ ¸è¦æ±‚ï¼šé€šéŽè³‡æ ¼å¯©æŸ¥èˆ‡ç°¡å ±è©•é¸

**Q12ï¼šé’å‰µåŸºåœ°å¤šä¹…æ‹›å‹Ÿä¸€æ¬¡ï¼Ÿ**
Aï¼šæ¯åŠå¹´è¾¦ç†ä¸€æ¬¡é€²é§å¯©æŸ¥ï¼Œæ‹›å‹Ÿå…¬å‘Šæœƒæå‰åœ¨å®˜æ–¹æ¸ é“ç™¼å¸ƒ

**Q13ï¼šç”³è«‹é’å‰µåŸºåœ°è¦æº–å‚™å“ªäº›è³‡æ–™ï¼Ÿ**
Aï¼šæ ¸å¿ƒè³‡æ–™ï¼š**å‰µæ¥­è¨ˆç•«ç°¡å ±**ï¼ˆå«åœ˜éšŠä»‹ç´¹ã€é …ç›®æ–¹æ¡ˆã€å¸‚å ´åˆ†æžã€ç™¼å±•è¦åŠƒï¼‰
   å…¶ä»–è³‡æ–™ï¼šå…¬å¸ç™»è¨˜è­‰æ˜Žï¼ˆå¦‚æœ‰ï¼‰

### A3 é’å‰µèª²ç¨‹ä¸»é¡Œ

**Q21ï¼šé’å‰µåŸºåœ°æœ€è¿‘æœ‰ä»€éº¼èª²ç¨‹ï¼Ÿ**
Aï¼šéœ€é€šéŽå®˜æ–¹æ¸ é“æŸ¥è©¢æœ€æ–°èª²ç¨‹ï¼š
   â‘  "æ¡ƒåœ’é’å‰µäº‹"Facebookå°ˆé 
   â‘¡ æ¡ƒåœ’å¸‚æ”¿åºœé’å¹´äº‹å‹™å±€å®˜ç¶²

**Q25ï¼šèª²ç¨‹ä¸»è¦æ•™å“ªäº›å…§å®¹ï¼Ÿ**
Aï¼šæ ¸å¿ƒå…§å®¹åˆ†é¡žï¼š
   â‘  å‰µæ¥­åŸºç¤Žï¼šå•†æ¥­è¨ˆç•«æ’°å¯«ã€æ³•è¦èªçŸ¥
   â‘¡ æŠ€èƒ½æå‡ï¼šæ•¸ä½å·¥å…·æ‡‰ç”¨ã€å¾®åž‹å‰µæ¥­å¯¦å‹™
   â‘¢ å¯¦è¸æ“ä½œï¼šå‰µå®¢å¯¦ä½œï¼ˆ3Dæ‰“å°/é›·å°„åˆ‡å‰²ï¼‰
   â‘£ è³‡æºå°æŽ¥ï¼šå‰µæ–°å‰µæ¥­äº¤æµèšæœƒ

### A4 å‰µæ¥­è³‡é‡‘ä¸»é¡Œ

**Q31ï¼šé’å¹´å‰µæ¥­è²¸æ¬¾æœ€é«˜å¯è²¸å¤šå°‘ï¼Ÿ**
Aï¼šåˆ†å…©é¡žè³‡é‡‘æ”¯æŒï¼š
   â‘  ç›´æŽ¥è£œåŠ©é¡žï¼šæœ€é«˜20è¬å…ƒï¼ˆå¦‚ç¤¾æœƒä¼æ¥­è¨­å‚™è£œåŠ©ã€åœ‹éš›äº‹å‹™è£œåŠ©ï¼‰
   â‘¡ è²¸æ¬¾é¡žï¼š"ä¿¡ç”¨ä¿è­‰èžè³‡å°ˆæ¡ˆ"é¡åº¦éœ€è«®è©¢é’å‰µè³‡æºä¸­å¿ƒï¼ˆ(03)422-0908ï¼‰

**Q35ï¼šç¤¾æœƒä¼æ¥­å‰µæ¥­è£œåŠ©æ˜¯ä»€éº¼ï¼Ÿ**
Aï¼šé‡å°ç¤¾æœƒä¼æ¥­çš„å°ˆé …è³‡é‡‘æ”¯æŒï¼Œå«å…©é …è£œè²¼ï¼š
   â‘  ç§Ÿé‡‘è£œè²¼ï¼šæ¯æœˆæœ€é«˜8000å…ƒï¼Œæœ€é•·2å¹´
   â‘¡ è¨­å‚™è£œè²¼ï¼šæœ€é«˜20è¬å…ƒï¼ˆä¸å«æ¶ˆè€—å“ï¼‰
   é©ç”¨é ˜åŸŸï¼šå¼±å‹¢é—œæ‡·ã€é•·ç…§ã€åœ¨åœ°å‰µç”Ÿã€ç’°ä¿ã€å…¬å¹³è²¿æ˜“

### A5 å‰µæ¥­æ´»å‹•è£œåŠ©ä¸»é¡Œ

**Q41ï¼šè¾¦å‰µæ¥­è¬›åº§å¯ä»¥ç”³è«‹è£œåŠ©å—Žï¼Ÿ**
Aï¼šå¯ä»¥ï¼Œä¾"é’å¹´è·æ¶¯ç™¼å±•åŠå‰µæ¥­æ´»å‹•è£œåŠ©ä½œæ¥­è¦é»ž"ç”³è«‹ï¼Œè£œåŠ©å°è±¡åŒ…å«åœ˜é«”ã€å­¸æ ¡ã€é’å‰µåŸºåœ°é€²é§åœ˜éšŠ

**Q45ï¼šæ´»å‹•è£œåŠ©ç”³è«‹æœŸé™æ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ**
Aï¼šâ‘  å–®æ¬¡æ´»å‹•ï¼šéœ€åœ¨æ´»å‹•é–‹å§‹å‰**è‡³å°‘20æ—¥**æäº¤ç”³è«‹
   â‘¡ å¹´åº¦å¸¸è¦æ´»å‹•ï¼šéœ€é—œæ³¨å®˜ç¶²åˆ†æœŸæ‹›å‹Ÿå…¬å‘Š

### A6 å¿—å·¥ä¸»é¡Œ

**Q51ï¼šå“ªè£¡å¯ä»¥çœ‹åˆ°å¿—å·¥æ´»å‹•è³‡è¨Šï¼Ÿ**
Aï¼šä¸»è¦é€šéŽ**é’å¹´å¿—å·¥è³‡æºä¸­å¿ƒ**ç²å–ï¼š
   â‘  é›»è©±è«®è©¢ï¼š03-4225205åˆ†æ©Ÿ6004/6026
   â‘¡ ç·šä¸Šæ¸ é“ï¼š"é’å¹´äº‹å‹™å±€"å®˜ç¶²/FBå°ˆé 
   â‘¢ ç·šä¸‹æ¸ é“ï¼šé’å¹´å±€æœå‹™çª—å£

**Q53ï¼šå¿—å·¥æœå‹™æœ‰æä¾›æ™‚æ•¸è­‰æ˜Žå—Žï¼Ÿ**
Aï¼šæœ‰ï¼Œé’å¹´å¿—å·¥è³‡æºä¸­å¿ƒæœƒç‚ºå®Œæˆæœå‹™çš„å¿—å·¥æä¾›**å¿—é¡˜æœå‹™æ™‚é•·è¨˜éŒ„è­‰æ˜Ž**ï¼Œå¯ç”¨æ–¼å­¸æ ¡å­¸åˆ†èªå®šæˆ–å±¥æ­·è£œå……

**Q55ï¼šå¯ä»¥å ±ååœ‹éš›å¿—å·¥å—Žï¼Ÿ**
Aï¼šå¯ä»¥ï¼Œå…©ç¨®åƒèˆ‡æ–¹å¼ï¼š
   â‘  åœ˜éšŠç”³è«‹ï¼š6äººä»¥ä¸Šåœ˜éšŠå¯ç”³"é’å¹´åœ‹éš›å¿—å·¥æœå‹™éšŠè£œåŠ©"
   â‘¡ å€‹äººå ±åï¼šé€šéŽé’å¹´å¿—å·¥è³‡æºä¸­å¿ƒå°æŽ¥åœ‹éš›å¿—å·¥åˆä½œé …ç›®

### A7 ç¤¾æœƒåƒèˆ‡ä¸»é¡Œ

**Q61ï¼šæƒ³åƒèˆ‡ç¤¾å€ç‡Ÿé€ ï¼Œæœ‰ä»€éº¼ç®¡é“ï¼Ÿ**
Aï¼šå¯åƒåŠ "é’å¹´æŠ•å…¥æ°¸çºŒç™¼å±•è¡Œå‹•è¨ˆç•«"ï¼Œå…©å€‹çµ„åˆ¥ï¼š
   â‘  å‰µæ–°è¨ˆç•«çµ„
   â‘¡ é ˜èˆªè¨ˆç•«çµ„
   æ”¯æŒå…§å®¹ï¼šè¨ˆç•«è£œåŠ©ã€å°ˆæ¥­è¼”å°Žã€æˆæžœç™¼è¡¨æ©Ÿæœƒ

---

## ã€æ–‡ä»¶å››ã€‘114å¹´9æœˆæ¥­å‹™ç°¡å ± â€” å‰µæ¥­å°±æ¥­è³‡æºèˆ‡å¤šå…ƒç™¼å±•

### ä¸€ã€å‰µæ¥­è«®è©¢æœå‹™èˆ‡è³‡æº

**1. å‰µæ¥­è«®è©¢æœå‹™**
- æä¾›å‰µæ¥­è«®è©¢æœå‹™ï¼Œä¸é™å‰µæ¥­é¡žåž‹
- æä¾›ç·šä¸Šç·šä¸‹è«®è©¢åŠå»ºè­°

**2. é’å¹´å‰µæ¥­è³‡æºä¸­å¿ƒ**
- **ä¸»é¡Œå‰µæ¥­èª²ç¨‹**ï¼š
  - å¾®å‰µä¸»é¡Œï¼šæ¶µè“‹å’–å•¡ã€æœé£¾ã€é¤é£²ç­‰
  - å¯¦ç”¨å•†å‹™èª²ç¨‹ï¼šæ¶µè“‹ç¨…å‹™ã€æ³•å¾‹ã€å•†æ¥­æ¨¡å¼ã€ç°¡å ±æŠ€å·§
- **å°ˆå®¶æ¥­å¸«è¼”å°Ž**ï¼š
  - é ˜åŸŸåŒ…å«è¡ŒéŠ·ã€æ³•å¾‹ã€è²¡å‹™ã€æœƒè¨ˆç­‰
  - æœå‹™é …ç›®åŒ…å«å’–å•¡ä¸»é¡Œèª²ç¨‹èˆ‡å°ˆå®¶æ¥­å¸«è¼”å°Žè«®è©¢

---

### äºŒã€å„é’å‰µä¸»é¡ŒåŸºåœ°ä»‹ç´¹

#### 1. é’å‰µæŒ‡æ®éƒ¨ (TY Commander)
- **åœ°ç†ä½ç½®**ï¼šä¸­å£¢å€é’å¹´å±€å±€æœ¬éƒ¨3æ¨“
- **åŸºåœ°ä¸»é¡Œ**ï¼šç¶œåˆå‰µæ–°æŠ€è¡“æ‡‰ç”¨
- **æˆç«‹æ™‚é–“**ï¼š105å¹´é–‹å§‹ç‡Ÿé‹è‡³ä»Š8å¹´ï¼Œç‚ºé’å¹´å±€ç¬¬ä¸€å€‹é’å‰µåŸºåœ°
- **å„ªç§€åœ˜éšŠæ¡ˆä¾‹**ï¼š
  - **æ°´åŠ›å‡ˆ**ï¼šä»¥æ°´åˆ†å­è§£éˆå°ˆåˆ©ç¨å®¶æŠ€è¡“ï¼Œå¹«åŠ©æ°´å†·å¼ç©ºèª¿å¡”æ©Ÿçµ„æ¸›ç¢³ç¯€èƒ½
  - **é…å®¢å˜‰**ï¼šç ”ç™¼å¯é‡è¤‡ä½¿ç”¨çš„å¾ªç’°åŒ…è£ï¼Œå¾ªç’°å¯„é€ã€æ–¹ä¾¿è¿”é‚„ï¼Œè§£æ±ºåŒ…æåžƒåœ¾éŽé‡å•é¡Œ

#### 2. å®‰æ±é’å‰µåŸºåœ° (Andong Youth Startup Hub)
- **åœ°ç†ä½ç½®**ï¼šæ¡ƒåœ’å€å®‰æ±è¡—
- **åŸºåœ°ä¸»é¡Œ**ï¼šAR/VR/MRåŠæ•¸ä½å…§å®¹æ‡‰ç”¨
- **æˆç«‹æ™‚é–“**ï¼š106å¹´é–‹å§‹ç‡Ÿé‹è‡³ä»Š7å¹´
- **å„ªç§€åœ˜éšŠæ¡ˆä¾‹**ï¼š
  - **è³¦èƒ½çŸ¥èŽ˜ï¼ˆè²æ€ç†Šï¼‰**ï¼šçµåˆå­¸å‰æ•™è‚²åŠå…’ç«¥ç™¼å±•ï¼ŒæŽ¨å‡ºé‚è¼¯æ€ç¶­æ•¸ä½æ•™è‚²èª²ç¨‹
  - **æ–¹èˆŸæ™ºæ…§**ï¼šé‹ç”¨å…ƒå®‡å®™ç§‘æŠ€è®“äººé¡žæ–‡åŒ–éºç”¢å»ºç«‹å°ˆå±¬æ•¸ä½åˆ†èº«ï¼Œèšç„¦3Då¯¦ç‰©å»ºæ¨¡èˆ‡VRæŠ€è¡“

#### 3. ä¸­è·¯é›»å•†åŸºåœ° (T-select)
- **åœ°ç†ä½ç½®**ï¼šæ¡ƒåœ’å€ä¸­è·¯4è™Ÿç¤¾æœƒä½å®…2æ¨“
- **æˆç«‹æ™‚é–“**ï¼š113å¹´6æœˆæˆç«‹ï¼ŒåŸºåœ°é¢ç©ç´„140åª
- **åŸºåœ°ä»‹ç´¹èˆ‡åŠŸèƒ½**ï¼š
  - è¨­æœ‰ç›´æ’­æ£šã€æ”å½±å®¤ã€è¼”å°Žè«®è©¢å®¤åŠå±•ç¤ºäº¤æµç©ºé–“
  - åª’åˆé›»å•†å‰µæ¥­è³‡æºåŠåŸ¹è‚²é›»å•†ç”¢æ¥­éˆäººæ‰
  - è¼”å°Žåœ¨åœ°æ¥­è€…å­¸ç¿’æ‹“å±•é›»å•†é€šè·¯ä¸¦ç¶“ç‡Ÿå“ç‰Œ
  - å”åŠ©å‚³çµ±é›¶å”®æ¥­è€…å°Žå…¥ç§‘æŠ€é›²æœå‹™
  - æŽ¨å»£æ¡ƒåœ’ç‰¹è‰²ç”¢å“/éŠç¨‹ (T-SELECT)

#### 4. æ–°å‰µåŠ é€ŸåŸºåœ°ï¼ˆèšç„¦æ•¸ä½æŠ€è¡“èˆ‡å‡ºæµ·ï¼‰
- **åœ°ç†ä½ç½®**ï¼šæ¡ƒåœ’å€ä¸­è·¯3è™Ÿç¤¾æœƒä½å®…3æ¨“
- **æˆç«‹æ™‚é–“**ï¼šå¯¦é«”å ´é¤¨å·²æ–¼7æœˆ18æ—¥é–‹å¹•ï¼ŒåŸºåœ°é¢ç©ç´„300åª
- **åŸºåœ°ä¸»é¡Œèˆ‡è³‡æº**ï¼š
  - å¸å¼•å…·æ•¸ä½æŠ€è¡“ä¹‹å…¨åœ‹æ€§å„ªç§€é’å‰µåœ˜éšŠï¼ˆå¦‚FITIå¾—çŽåœ˜éšŠï¼‰è‡³æ¡ƒåœ’è¨­ç«‹å…¬å¸
  - æ•´åˆä¸­å¤®è³‡æºï¼ˆå¦‚ç§‘ç ”å‰µæ¥­è¨ˆç•«ã€TREE Awardï¼‰ï¼Œæä¾›ç©ºé–“å„ªæƒ ã€å•†å‹™åª’åˆè£œåŠ©åŠæœªä¾†æ¡ƒé’åŸºåœ°é‡é»žæŠ•è³‡ç­‰ç›¸é—œè³‡æº
  - ç›®æ¨™ç™¼å±•æµ·å¤–å¸‚å ´ï¼ˆæ¡ƒåœ’å¤©éš›ç·š SKYLINEï¼‰

#### 5. A8åŠ é€ŸåŸºåœ° (A8 Accelerator)
- **åœ°ç†ä½ç½®**ï¼šé•·åºšè½‰é‹ç«™5æ¨“
- **æˆç«‹æ™‚é–“**ï¼šé è¨ˆæ–¼114å¹´3æœˆæˆç«‹ï¼Œ114å¹´3æœˆ25æ—¥é–‹å¹•
- **å‰å°Žè¨ˆç•«**ï¼šå·²æ–¼113å¹´è¾¦ç†å‰å°Žè¨ˆç•«ï¼Œè¼”å°Ž10çµ„æ–°å‰µå…¬å¸èˆ‡æœ¬å¸‚ä¼æ¥­åˆä½œæ¦‚å¿µé©—è­‰
- **åŸºåœ°ä¸»é¡Œ**ï¼š
  - åœ°æ–¹æ”¿åºœé¦–å‰µçš„ç”¢æ¥­åž‹åŠ é€Ÿå™¨
  - åª’åˆæˆç†Ÿé’å‰µèˆ‡åœ¨åœ°ä¸­å°è£½é€ æ¥­ï¼Œå”åŠ©ä¼æ¥­è½‰åž‹èˆ‡é’å‰µåœ¨ç”¢æ¥­ITã€OTç«¯åŠä½Žç¢³æŠ€è¡“å°æŽ¥
- **è¼”å°Žé€²ç¨‹**ï¼šåŒ…å«PoC(æ¦‚å¿µé©—è­‰)ã€PoS(æœå‹™é©—è­‰)ã€PoB(å•†æ¥­é©—è­‰)ã€å¸‚å ´èª¿æŸ¥ã€è©¦ç”¢ã€å‹Ÿè³‡èˆ‡æŠ€è½‰ç­‰å®Œæ•´æµç¨‹

#### 6. æ¡ƒåœ’è¨­è¨ˆåº« (Taoyuan Design Cool)
- **åœ°ç†ä½ç½®**ï¼šä¸­å£¢æ–°æ˜Žå¸‚å ´6æ¨“
- **æˆç«‹æ™‚é–“**ï¼š110å¹´10æœˆ26æ—¥
- **åŠŸèƒ½**ï¼šå­µè‚²è¨­è¨ˆåœ˜éšŠã€å•†æ¥­åª’åˆã€è¾¦ç†è¨­è¨ˆæ”¯æ´èª²ç¨‹åŠå±•è¦½ç«¶è³½
- **ç›®æ¨™**ï¼šåŸ¹è‚²è¨­è¨ˆäººæ‰ï¼Œé‚å‘è¨­è¨ˆä¹‹éƒ½
- **æ´»å‹•**ï¼šé€²é§è€…å°èšã€è¨­è¨ˆæˆæžœè¯å±•ã€åŸŽå¸‚ç¯€å¥è¨­è¨ˆå°è«‡ã€A+æ–‡åŒ–è³‡ç”¢å‰µæ„ç²¾é¸å±•

#### 7. æ¡ƒè—å·¥åŠæ–‡å‰µåŸºåœ° (T-art Workshop)
- **åœ°ç†ä½ç½®**ï¼šä¸­åŽŸæ–‡å‰µåœ’å€äº”è™Ÿå€‰åº«
- **æˆç«‹æ™‚é–“**ï¼š113å¹´4æœˆ27æ—¥é–‹å¹•ç‡Ÿé‹
- **ç‡Ÿé‹é …ç›®**ï¼šå“ç‰Œè¡ŒéŠ·ã€å±•éŠ·å•†æ©Ÿã€å•†æ¥­ç™»è¨˜ã€å¸‚å ´é©—è­‰
- **ç‰¹è‰²**ï¼šè¨­æœ‰æ°‘çœ¾åƒè§€å€ã€è·äººä½œå“å±•å”®åŠé™å®šç›¸æ¡†æ‹è²¼æ©Ÿ

#### 8. ä¸€è™Ÿç©ºé–“åœ°æ–¹å‰µç”ŸåŸºåœ° (ONE HOW SPACE)
- **åŠŸèƒ½**ï¼šæä¾›é’å¹´å‰µç”Ÿç”¢å“å±•å”®é©—è­‰ç©ºé–“ï¼Œè®“é’å¹´ç›´æŽ¥é¢å°æ¶ˆè²»è€…é©—è­‰å¸‚å ´æŽ¥å—åº¦
- **ç©ºé–“é…ç½®**ï¼š
  - **1é–“å’–å•¡å§ (Inbar)**ï¼šæ”¯æŒè¿”é„‰é’å¹´é€²é§
  - **2é–“å¯„å”®ç©ºé–“**ï¼šå±•å”®åœ°æ–¹å‰µç”Ÿåœ˜éšŠå•†å“

#### 9. æ¡ƒåœ’ç¤¾æœƒä¼æ¥­ä¸­å¿ƒå¹³éŽ®é¤¨
- **ç‰¹è‰²**ï¼šé¼“å‹µç¤¾æœƒä¼æ¥­å‰µæ¥­è€…è·¨åŸŸäº¤æµï¼Œå…·å‚™å»šæˆ¿è¨­å‚™
- **é€²é§è³‡è¨Š**ï¼š3é–“é€²é§ç©ºé–“ï¼ˆæœ€å¤§18åªï¼‰ï¼Œæ¯æœˆç§Ÿé‡‘2,000å…ƒèµ·
- **æ´»å‹•**ï¼šå®šæœŸè¾¦ç†å‰µæ¥­å®¶å°èšåŠåœ˜éšŠæŽ¨å»£æ´»å‹•

---

### ä¸‰ã€äººæ‰åŸ¹è‚²ï¼šé’å‰µå¯¦ç¿’ç”Ÿè¨ˆç•«ï¼ˆè·å ´å¯¦ç¿’æŽ¢ç´¢ï¼‰

**1. è¨ˆç•«æ ¸å¿ƒæž¶æ§‹**
æœ¬è¨ˆç•«æ—¨åœ¨é€£çµã€Œé’å‰µä¼æ¥­ã€èˆ‡ã€Œå¤§å°ˆé’å¹´ã€ï¼Œè§£æ±ºé›™æ–¹éœ€æ±‚ï¼š
- **é’å‰µä¼æ¥­ç«¯**ï¼šè§£æ±ºã€Œç¼ºæ‰ã€èˆ‡ç™¼å±•ã€Œå›°å¢ƒã€
- **å¤§å°ˆé’å¹´ç«¯**ï¼šå”åŠ©ã€Œèªè­˜æ–°å‰µã€ç”¢æ¥­
- **å…±åŒç›®æ¨™**ï¼šä¿ƒæˆé›™æ–¹çš„ã€Œè·æ¶¯é«”é©—ã€èˆ‡äº¤æµ

**2. ä¿ƒé€²é’å¹´ç™¼å±•å°±æ¥­å››éƒ¨æ›²**
- **01 è·æ¶¯èª²ç¨‹**ï¼šèˆ‰è¾¦ **40å ‚å¯¦é«”èª²ç¨‹**ï¼Œç›®æ¨™ï¼šå¥ å®šé€²å…¥è·å ´çš„åŸºç¤ŽæŠ€èƒ½ï¼Œæ‹‰è¿‘èˆ‡è·å ´ä¹‹é–“çš„è·é›¢
- **02 è·å ´é«”é©—**ï¼šèˆ‰è¾¦ **50å ´é«”é©—å ´æ¬¡**ï¼Œç›®æ¨™ï¼šæŽ¢ç´¢è‡ªèº«è·æ¶¯æ–¹å‘ï¼ˆæ¡ˆä¾‹ï¼šé‚€è«‹é’å‰µåŸºåœ°ç•¢æ¥­åœ˜éšŠã€Œæš´é¢¨æ•¸ä½è‚¡ä»½æœ‰é™å…¬å¸ã€åŸ·è¡Œé•·åˆ†äº«ï¼‰
- **03 å¯¦å‹™è¨“ç·´**ï¼šæä¾› **100å€‹å¯¦ç¿’æ©Ÿæœƒ**ï¼Œç›®æ¨™ï¼šä½œç‚ºè·å ´å‰å“¨ç«™ï¼Œç´¯ç©å¯¦å‹™ç¶“é©—
- **04 è·å ´å°æŽ¥**ï¼šæä¾› **300å€‹æ­£è·è·ç¼º**ï¼Œåˆä½œä¼æ¥­è‡³å°‘ **100å®¶**ï¼Œç›®æ¨™ï¼šæ‰“é€ è·å ´å¿«é€Ÿé€šé“

---

### å››ã€é’å¹´ç¯€ç³»åˆ—æ´»å‹•

- **ç›®çš„**ï¼šå‡èšæ¡ƒåœ’é’å¹´ä¸–ä»£åŠ›é‡ï¼Œæ‰“é€ å¤šå…ƒå¹³å°ï¼Œé¼“å‹µé’å¹´ç©æ¥µåƒèˆ‡ï¼Œå±•ç¾æŒ‘æˆ°è‡ªæˆ‘èˆ‡çªç ´æ¥µé™çš„ç²¾ç¥ž
- **æ´»å‹•å…§å®¹ï¼ˆ114å¹´ï¼‰**ï¼šåŒ…å«æ‹è²¼æ©Ÿã€å¤šå…ƒå¸‚é›†ã€æ‰‹ä½œDIYã€ç™¼å‘†å¤§è³½ã€è—äººè¡¨æ¼”ã€é’æ˜¥ç•™è¨€æ¿

---

### äº”ã€2024æ¡ƒåœ’é’å¹´è¨­è¨ˆå±•æš¨åœ‹éš›è«–å£‡

- **è¾¦ç†ç¸¾æ•ˆ**ï¼š
  - é›†çµæœ¬å¸‚5æ‰€å¤§å°ˆé™¢æ ¡åŠ3æ‰€é«˜ä¸­è·å­¸æ ¡
  - åœ¨åœ°2å®¶æ–°éŠ³è¨­è¨ˆå¸«åœ˜éšŠåŠ5å®¶åœ‹éš›åœ˜éšŠï¼ˆç¾©å¤§åˆ©ã€æ—¥æœ¬ã€å¾·åœ‹ã€æ–°åŠ å¡ã€è¶Šå—ï¼‰åƒèˆ‡ç­–å±•
  - é‚€è«‹è‹±ã€ç¾Žã€æ—¥ã€è¶Šè¨­è¨ˆå°ˆå®¶é€éŽè«–å£‡åˆ†äº«ç¶“é©—
- **æ´»å‹•æˆæ•ˆ**ï¼š113å¹´11æœˆ10æ—¥è‡³18æ—¥èˆ‰è¡Œï¼Œå…±3,334äººæ¬¡åƒèˆ‡
- **ç›®æ¨™**ï¼šæŽ¥è»Œåœ‹éš›è³‡æºã€æå‡åœ¨åœ°è¨­è¨ˆèƒ½é‡ã€å½¢å¡‘æ¡ƒåœ’ç‚ºå°ç£è¨­è¨ˆä¹‹éƒ½

---

### å…­ã€æ ¡åœ’ç¤¾åœ˜è³‡æºä¸­å¿ƒ

**1. æœå‹™å…§å®¹**
- å”åŠ©è£œåŠ©è³‡æºç”³è«‹ã€å…è²»å ´åœ°å€Ÿç”¨ã€å¤šå…ƒèª²ç¨‹æ´»å‹•è¾¦ç†ã€æä¾›å­¸ç¿’æ­·ç¨‹æ™‚æ•¸è­‰æ˜Ž

**2. é‡é»žæ´»å‹•**
- **æ ¡åœ’è³‡æºèŒ¶æœƒ**ï¼šæŽ¨å»£ç¤¾åœ˜è£œåŠ©ã€å ´åœ°å€Ÿç”¨ç­‰è³‡æºï¼Œå®£å°Žå°è±¡å«æ‹¬æœ¬å¸‚é«˜ä¸­è·èˆ‡å¤§å°ˆé™¢æ ¡
- **ç¤¾åœ˜ä¸»é¡Œè¡Œå‹•**ï¼šä¿ƒé€²è·¨æ ¡è·¨ç¤¾åœ˜äº¤æµï¼ˆå¦‚ç±ƒçƒç¤¾ã€ç†±éŸ³ç¤¾ã€åº·è¼”ç¤¾ç­‰ï¼‰ï¼Œä¿ƒæˆç¤¾åœ˜å¤šå…ƒç™¼å±•
- **ç¤¾åœ˜å¹¹éƒ¨è¨“ç·´**ï¼šè¾¦ç†é«˜ä¸­è·èˆ‡å¤§å°ˆé™¢æ ¡å¹¹éƒ¨è¨“ç·´ç‡Ÿï¼ŒåŸ¹é¤Šé ˜å°Žç®¡ç†èƒ½åŠ›ï¼Œç”±å­¸é•·å§å‚³æ‰¿ç¶“é©—ï¼Œä¸¦é€éŽæˆæžœç™¼è¡¨å±•ç¾åŸ¹è¨“æˆæžœ

---

### ä¸ƒã€æ¡ƒåœ’å¸‚é’å¹´é«”é©—å­¸ç¿’åœ’å€

- **åœ°ç†ä½ç½®**ï¼šæ¡ƒåœ’å¸‚æ–°å±‹å€æ–°æ¸¯è·¯16è™Ÿ
- **ç‡Ÿé‹æ¨¡å¼**ï¼šæŽ¡ROTï¼ˆé‡å»ºã€ç‡Ÿé‹ã€ç§»è½‰ï¼‰æ–¹å¼ï¼Œç”±å¤§æ—¥é–‹ç™¼è‚¡ä»½æœ‰é™å…¬å¸ç‡Ÿé‹
- **è¨­æ–½ç‰¹è‰²**ï¼šæä¾›60é …é«˜ä½Žç©ºç¹©ç´¢é …ç›®ï¼ˆåŒ—å°ç£æœ€å¤šï¼‰ï¼ŒåŒ…å«ä½Žç©ºæŽ¢éšªã€é«˜ç©ºæŽ¢éšªã€è‡ªæˆ‘ç¢ºä¿å€ã€CSå®‰å…¨å¼“ç®­ã€é¢¨é›¨æ“å ´ç­‰
- **èªè­‰èˆ‡æœå‹™**ï¼š112å¹´é€šéŽç’°å¢ƒæ•™è‚²èªè­‰å ´æ‰€ã€‚æ¯å¹´æä¾›600äººæ¬¡å…¬ç›Šåé¡ï¼ˆä»¥æ¡ƒåœ’å¸‚å„ªå…ˆã€æ‰¶æ¤å¼±å‹¢ï¼‰ï¼Œå­¸è¡“æˆ–å…¬ç›Šåœ˜é«”äº«8æŠ˜å„ªæƒ 

---

### å…«ã€åŒ—å€é’å°‘å¹´æ´»å‹•ä¸­å¿ƒ-æ¡ƒæ¼¾é¤¨

- **åœ°ç†ä½ç½®**ï¼šæ¡ƒåœ’å¸‚å…«å¾·å€å»ºå¾·è·¯350è™Ÿ
- **ç‡Ÿé‹é€²ç¨‹**ï¼šæŽ¡ROTæ–¹å¼ï¼Œèˆ‡ä¸­åœ‹é’å¹´æ•‘åœ‹åœ˜ç°½ç´„
  - ç¬¬ä¸€éšŽæ®µï¼š114å¹´2æœˆ11æ—¥æ­£å¼ç‡Ÿé‹
  - ç¬¬äºŒéšŽæ®µï¼š114å¹´8æœˆ10æ—¥å•Ÿç”¨äºŒæ¨“ç¹©ç´¢æŒ‘æˆ°ä¸­å¿ƒ
- **ç©ºé–“è¦åŠƒ**ï¼š
  - **6F**ï¼šå¯¦å¢ƒé«”é©—åŸºåœ°ï¼ˆå¯¦å¢ƒåŠå¤šåŠŸèƒ½æ•™å®¤ï¼‰
  - **5F**ï¼šæ–œæ§“å…±äº«åŸºåœ°ï¼ˆè¾¦ç†é›»ç«¶ã€ç„¡äººæ©ŸåŠå±•æ¼”æ´»å‹•ï¼‰
  - **4F**ï¼šå‰µæ–°å­¸ç¿’åŸºåœ°ï¼ˆæ²‰æµ¸å¼é«”é©—åŠå¥èº«ä¸­å¿ƒï¼‰
  - **3F**ï¼šçŽ©ç¾Žé¤ŠæˆåŸºåœ°ï¼ˆéŸ³æ¨‚åŠèˆžè¹ˆæ•™å®¤ï¼‰
  - **2F**ï¼šæ¥µé™æŒ‘æˆ°åŸºåœ°ï¼ˆç¹©ç´¢å ´åŠç§‘æŠ€æŽ¢ç´¢ä¸­å¿ƒï¼‰
  - **1F**ï¼šèƒ½é‡è£œçµ¦åŸºåœ°ï¼ˆé¤å»³åŠé›¶å”®å•†åº—ï¼‰åŠ B1/B2 åœ°ä¸‹åœè»Šå ´

---

### ä¹ã€ä¿ƒé€²é’å¹´èº«å¿ƒå¥åº·

**1. ç›®æ¨™**
- åŸ¹è‚²é’å¹´å­¸å­æ­£ç¢ºåƒ¹å€¼è§€ã€å¢žé€²è¨Šæ¯åˆ¤æ–·åŠ›ã€å­¸ç¿’å°Šé‡åŠåŒ…å®¹

**2. åŸ·è¡Œæ–¹æ³•**
- **æ ¡åœ’åæ¯’åæš´åŠ›å®£å°Ž**ï¼šçµåˆè¡›ç”Ÿå±€ã€è­¦å¯Ÿå±€ã€ç¤¾æœƒå±€åŠåæ¯’å¤§ä½¿ï¼Œè‡³é«˜ä¸­è·åŠå¤§å°ˆé™¢æ ¡å·¡è¿´å®£å°Ž
- **èº«å¿ƒå¥åº·æŽ¨å»£**ï¼šèˆ‰è¾¦ã€Šé’æ˜¥è¬›å”±æœƒã€‹ï¼Œé‚€è«‹KOLåŠè¡¨æ¼”åœ˜é«”åˆ†äº«ç¶“æ­·
- **ç¶²è·¯å…¬æ°‘ç´ é¤ŠæŽ¨å»£**ï¼šèˆ‰è¾¦ã€Šç¶²è·¯å…¬æ°‘ç´ é¤Šæ²™é¾ã€‹ï¼Œå»ºç«‹æ­£ç¢ºç¶²è·¯å…¬æ°‘ç´ é¤Šèˆ‡åª’é«”è­˜è®€åŠ›

---

### åã€ä¿ƒé€²é’å¹´ç¤¾æœƒåƒèˆ‡

**1. è£œåŠ©è¨ˆç•«**
- **ç¤¾æœƒåƒèˆ‡è£œåŠ©**ï¼š114å¹´å·²æ ¸å®š143ä»¶ã€‚æ”¯æŒè¾¦ç†äººæ‰åŸ¹åŠ›ã€è¡—å€ç¾Žå­¸æ”¹é€ ã€è¡¨æ¼”è—è¡“åŠå¤šå…ƒæ–‡åŒ–æ´»å‹•
- **ä¿ƒé€²é’å¹´ç¤¾æœƒåƒèˆ‡è£œåŠ©**ï¼šæ¯å¹´è£œåŠ©å­¸æ ¡è¾¦ç†é•·è€…æœå‹™ã€å…’ç«¥æ•™è‚²ç­‰å¿—é¡˜æœå‹™ç‡ŸéšŠ
- **æ°¸çºŒç™¼å±•è£œåŠ©**ï¼š114å¹´å·²æ ¸å®š95ä»¶ã€‚é´é¸é’å¹´è¡Œå‹•åœ˜éšŠï¼ˆ3äººä»¥ä¸Šã€15-45æ­²ï¼‰ï¼Œæ¯çµ„æœ€é«˜è£œåŠ©100è¬å…ƒçŽå‹µé‡‘ï¼ˆå¦‚ã€Œå±±ä¸Šå­¸æ ¡ã€ã€ã€Œå¾©èˆˆé£Ÿè¾²ã€åœ˜éšŠï¼‰

**2. é’å¹´å¿—å·¥è³‡æºä¸­å¿ƒ**
- **æ¡ƒé’å¿—å·¥éšŠ**ï¼šæ‹›å‹Ÿ15-45æ­²é’å¹´ï¼Œæ——ä¸‹è¨­ç«‹ä¸‰æ”¯åˆ†éšŠï¼š
  - **èžé’è¨˜è€…éšŠ**ï¼šåœ–æ–‡ç´€éŒ„æœå‹™æ•…äº‹ï¼Œç¶“ç‡Ÿç¤¾ç¾¤
  - **è·é’å¿—å·¥éšŠ**ï¼šæ“”ä»»æ´»å‹•åŠ©æ•™ï¼Œè¿‘è·é›¢äº†è§£è·äººèˆ‡å‰µæ¥­åœ˜éšŠ
  - **è‰é’å¿—å·¥éšŠ**ï¼šæ“”ä»»å¿—å·¥é ˜è¢–ï¼Œå¸¶é ˜æœå‹™æ´»å‹•æ·±å…¥è­°é¡Œ
- **æœå‹™å…§å®¹**ï¼šè¾¦ç†ä¸»é¡Œç‡ŸéšŠã€ç·šä¸Šæœå‹™è¨ˆç•«ï¼Œä¸¦ç¶“ç‡Ÿã€Œæ¡ƒé’åƒä¸€å’–ã€ç²‰çµ²å°ˆé 

**3. æ¡ƒåœ’å¸‚æ”¿åºœé’å¹´è«®è©¢æœƒ**
- **çµ„ç¹”æž¶æ§‹**ï¼šç¾ç‚ºç¬¬å…­å±†ï¼ˆä»»æœŸ114/3/29-115/3/28ï¼‰ï¼Œç”±å¸‚é•·æ“”ä»»å¬é›†äººï¼Œé´é¸51ä½é’å¹´å§”å“¡
- **åˆ†çµ„é‹ä½œ**ï¼šè¨­æœ‰ã€Œå…¬å…±åƒèˆ‡çµ„ã€ã€ã€Œæ™ºæ…§ç”Ÿæ´»çµ„ã€ã€ã€Œæ–‡åŒ–ç™¼å±•çµ„ã€åŠã€Œåœ‹éš›å±•æœ›çµ„ã€ï¼Œå®šæœŸå¬é–‹æœƒè­°ç”¢å‡ºå¸‚æ”¿ææ¡ˆ

---

### åä¸€ã€ç¤¾æœƒä¼æ¥­ä¸­å¿ƒ

- **é¡˜æ™¯**ï¼šæ‰“é€ æ¡ƒåœ’ç‚ºã€Œä¸–ç•Œç¤¾ä¼ä¹‹éƒ½ã€
- **å››å¤§æ ¸å¿ƒ**ï¼šè³‡é‡‘å‹å–„ã€é …ç›®å‹å–„ã€ç¤¾ç¾¤å‹å–„ã€è³‡æºå‹å–„ï¼ˆå«æ•¸ä½å‹å–„ï¼‰
- **æŽ¨å‹•ç­–ç•¥**ï¼šæ•´åˆæ”¿ç­–ç™¼å±•ç¤¾ä¼ã€æŽ¨å‹•åœ‹éš›äº¤æµï¼ˆå…¨çƒåœ¨åœ°åˆä½œï¼‰ã€åŸ¹è‚²äººæ‰ã€è¼”å°Žåœ˜éšŠç©©å¥æˆé•·'''


def utcnow() -> datetime.datetime:
    return datetime.datetime.utcnow()


def ensure_schema() -> None:
    """Create the SQLite schema if it does not exist yet."""
    with engine.begin() as conn:
        conn.execute(
            text(
                """
                CREATE TABLE IF NOT EXISTS members (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    external_id TEXT UNIQUE,
                    display_name TEXT,
                    avatar_url TEXT,
                    gender TEXT,
                    birthday TEXT,
                    email TEXT,
                    phone TEXT,
                    source TEXT,
                    created_at TIMESTAMP,
                    updated_at TIMESTAMP,
                    last_interaction_at TIMESTAMP
                )
                """
            )
        )
        conn.execute(
            text(
                """
                CREATE TABLE IF NOT EXISTS surveys (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    name TEXT NOT NULL,
                    description TEXT,
                    category TEXT,
                    is_active INTEGER DEFAULT 1,
                    created_at TIMESTAMP,
                    updated_at TIMESTAMP
                )
                """
            )
        )
        conn.execute(
            text(
                """
                CREATE TABLE IF NOT EXISTS survey_questions (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    survey_id INTEGER NOT NULL REFERENCES surveys(id) ON DELETE CASCADE,
                    question_type TEXT NOT NULL,
                    question_text TEXT NOT NULL,
                    description TEXT,
                    font_size INTEGER,
                    options_json TEXT,
                    is_required INTEGER DEFAULT 0,
                    display_order INTEGER DEFAULT 0,
                    created_at TIMESTAMP,
                    updated_at TIMESTAMP
                )
                """
            )
        )
        conn.execute(
            text(
                """
                CREATE TABLE IF NOT EXISTS survey_responses (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    survey_id INTEGER NOT NULL REFERENCES surveys(id) ON DELETE CASCADE,
                    member_id INTEGER REFERENCES members(id) ON DELETE SET NULL,
                    external_id TEXT,
                    answers_json TEXT NOT NULL,
                    is_completed INTEGER DEFAULT 1,
                    completed_at TIMESTAMP,
                    source TEXT,
                    ip_address TEXT,
                    user_agent TEXT,
                    created_at TIMESTAMP,
                    updated_at TIMESTAMP
                )
                """
            )
        )
        conn.execute(
            text(
                """
                CREATE TABLE IF NOT EXISTS chat_sessions (
                    id TEXT PRIMARY KEY,
                    created_at TIMESTAMP,
                    updated_at TIMESTAMP
                )
                """
            )
        )
        conn.execute(
            text(
                """
                CREATE TABLE IF NOT EXISTS chat_messages (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    session_id TEXT NOT NULL REFERENCES chat_sessions(id) ON DELETE CASCADE,
                    role TEXT NOT NULL,
                    content TEXT NOT NULL,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )
                """
            )
        )
        conn.execute(
            text(
                """
                CREATE INDEX IF NOT EXISTS idx_chat_messages_session_created
                ON chat_messages(session_id, created_at)
                """
            )
        )


ensure_schema()


def ensure_chat_session(session_id: Optional[str] = None) -> str:
    """Return an existing chat session id or create a new one."""
    chat_session_id = session_id or uuid.uuid4().hex
    now = utcnow()
    with engine.begin() as conn:
        conn.execute(
            text(
                """
                INSERT INTO chat_sessions (id, created_at, updated_at)
                VALUES (:id, :now, :now)
                ON CONFLICT(id) DO UPDATE SET updated_at = :now
                """
            ),
            {"id": chat_session_id, "now": now},
        )
    return chat_session_id


def save_chat_message(session_id: str, role: str, content: str) -> None:
    """Persist a chat message for a given session."""
    with engine.begin() as conn:
        conn.execute(
            text(
                """
                INSERT INTO chat_messages (session_id, role, content, created_at)
                VALUES (:sid, :role, :content, :created_at)
                """
            ),
            {
                "sid": session_id,
                "role": role,
                "content": content,
                "created_at": utcnow(),
            },
        )
        conn.execute(
            text(
                """
                UPDATE chat_sessions
                SET updated_at = :updated_at
                WHERE id = :sid
                """
            ),
            {"sid": session_id, "updated_at": utcnow()},
        )


def fetch_chat_history(session_id: str, limit: int = 12) -> List[Dict[str, Any]]:
    """Fetch the most recent chat history for the session in chronological order."""
    if limit <= 0:
        limit = 1

    query = text(
        f"""
        SELECT role, content
        FROM chat_messages
        WHERE session_id = :sid
        ORDER BY created_at DESC
        LIMIT {limit}
        """
    )

    with engine.begin() as conn:
        rows = conn.execute(query, {"sid": session_id}).mappings().all()

    # Reverse to chronological order
    return [dict(row) for row in reversed(rows)]


def build_assistant_messages(history: Iterable[Dict[str, str]], user_content: str) -> List[Dict[str, str]]:
    """Prepare the message payload for the OpenAI Responses API."""
    messages: List[Dict[str, str]] = []
    if SYSTEM_PROMPT:
        messages.append({"role": "system", "content": SYSTEM_PROMPT})
    if USER_PROMPT:
        messages.append({"role": "user", "content": USER_PROMPT})
    for item in history:
        role = item.get("role")
        content = (item.get("content") or "").strip()
        if role in {"user", "assistant"} and content:
            messages.append({"role": role, "content": content})
    messages.append({"role": "user", "content": user_content})
    return messages


def to_responses_input(messages: Iterable[Dict[str, str]]) -> List[Dict[str, Any]]:
    """Convert chat messages to the structure expected by the OpenAI Responses API."""
    structured: List[Dict[str, Any]] = []
    for message in messages:
        role = message["role"]
        content_type = "input_text"
        if role == "assistant":
            content_type = "output_text"
        structured.append(
            {
                "role": role,
                "content": [{"type": content_type, "text": message["content"]}],
            }
        )
    return structured


def format_sse(payload: Dict[str, Any]) -> str:
    """Serialize a Python dictionary into a Server-Sent Events data frame."""
    return f"data: {json.dumps(payload, ensure_ascii=False)}\n\n"


@app.post("/api/chat")
@app.post("/chat")
def api_chat():
    if not request.is_json:
        return jsonify({"error": "Payload must be JSON."}), 400

    payload = request.get_json(force=True) or {}
    message = (payload.get("message") or "").strip()
    requested_session = payload.get("session_id")

    if not message:
        return jsonify({"error": "message is required"}), 400

    session_id = ensure_chat_session(
        requested_session if isinstance(requested_session, str) else None
    )
    history = fetch_chat_history(session_id)

    # Persist the user's message before streaming.
    save_chat_message(session_id, "user", message)

    client = get_openai_client()

    def generate():
        logger.info("Streaming response for session %s", session_id)
        yield format_sse({"type": "session", "content": "", "session_id": session_id})

        if client is None:
            assistant_text = (
                "Unable to reach the OpenAI service right now. Please check the server logs.\n\n"
                f"Message waiting to send: {message}\n"
                "Confirm that OPENAI_API_KEY is configured before retrying."
            )
            save_chat_message(session_id, "assistant", assistant_text)
            yield format_sse(
                {"type": "text", "content": assistant_text, "session_id": session_id}
            )
            yield format_sse({"type": "end", "content": "", "session_id": session_id})
            return

        accumulated: List[str] = []
        try:
            structured_messages = build_assistant_messages(history, message)
            with client.responses.stream(
                model=OPENAI_MODEL,
                input=to_responses_input(structured_messages),
            ) as stream:
                for event in stream:
                    if event.type == "response.output_text.delta":
                        delta = event.delta or ""
                        if not delta:
                            continue
                        accumulated.append(delta)
                        yield format_sse(
                            {
                                "type": "text",
                                "content": delta,
                                "session_id": session_id,
                            }
                        )
                    elif event.type == "response.error":
                        error_message = getattr(event, "message", "") or "AI model error."
                        raise RuntimeError(error_message)

                final_response = stream.get_final_response()

        except Exception:
            logger.exception("Chat streaming failed for session %s", session_id)
            error_message = (
                "We hit an unexpected issue while generating the concierge reply."
                " Please try again shortly or reach our staff directly."
            )
            yield format_sse(
                {"type": "error", "content": error_message, "session_id": session_id}
            )
            return

        full_text = "".join(accumulated).strip()

        if not full_text:
            try:
                outputs = getattr(final_response, "output", None) or []
                for item in outputs:
                    for content in item.get("content", []):
                        if content.get("type") == "output_text":
                            full_text = content.get("text", "").strip()
                            if full_text:
                                break
                    if full_text:
                        break
            except Exception:
                full_text = ""

        if full_text:
            save_chat_message(session_id, "assistant", full_text)
        else:
            fallback_text = ("I'm sorry, I couldn't craft a reply just now. Please rephrase or contact our concierge team.")
            save_chat_message(session_id, "assistant", fallback_text)
            yield format_sse(
                {"type": "text", "content": fallback_text, "session_id": session_id}
            )

        yield format_sse({"type": "end", "content": "", "session_id": session_id})

    response = Response(
        stream_with_context(generate()),
        mimetype="text/event-stream",
    )
    response.headers["Cache-Control"] = "no-cache"
    response.headers["X-Accel-Buffering"] = "no"
    return response


def fetchall(sql: str, params: Optional[Dict[str, Any]] = None) -> List[Dict[str, Any]]:
    with engine.begin() as conn:
        return [
            dict(row)
            for row in conn.execute(text(sql), params or {}).mappings().all()
        ]


def fetchone(sql: str, params: Optional[Dict[str, Any]] = None) -> Optional[Dict[str, Any]]:
    with engine.begin() as conn:
        result = conn.execute(text(sql), params or {}).mappings().first()
        return dict(result) if result else None


def execute(sql: str, params: Optional[Dict[str, Any]] = None) -> None:
    with engine.begin() as conn:
        conn.execute(text(sql), params or {})


def _clean(value: Optional[str]) -> Optional[str]:
    if value is None:
        return None
    trimmed = str(value).strip()
    return trimmed or None


def upsert_member(
    external_id: Optional[str],
    display_name: Optional[str] = None,
    avatar_url: Optional[str] = None,
    gender: Optional[str] = None,
    birthday: Optional[str] = None,
    email: Optional[str] = None,
    phone: Optional[str] = None,
    source: Optional[str] = "form",
) -> Optional[int]:
    """Create or update a member record identified by an external id."""
    external_id = _clean(external_id)
    if not external_id:
        return None

    now = utcnow()
    data = {
        "display_name": _clean(display_name),
        "avatar_url": _clean(avatar_url),
        "gender": _clean(gender),
        "birthday": _clean(birthday),
        "email": _clean(email),
        "phone": _clean(phone),
        "source": source or "form",
        "updated_at": now,
        "last_interaction_at": now,
    }

    with engine.begin() as conn:
        existing = conn.execute(
            text("SELECT id FROM members WHERE external_id = :ext"),
            {"ext": external_id},
        ).scalar()
        if existing:
            conn.execute(
                text(
                    """
                    UPDATE members
                       SET display_name=:display_name,
                           avatar_url=:avatar_url,
                           gender=:gender,
                           birthday=:birthday,
                           email=:email,
                           phone=:phone,
                           source=:source,
                           updated_at=:updated_at,
                           last_interaction_at=:last_interaction_at
                     WHERE id=:member_id
                    """
                ),
                {**data, "member_id": existing},
            )
            return int(existing)

        insert_params = {
            "external_id": external_id,
            **data,
            "created_at": now,
        }
        result = conn.execute(
            text(
                """
                INSERT INTO members (
                    external_id,
                    display_name,
                    avatar_url,
                    gender,
                    birthday,
                    email,
                    phone,
                    source,
                    created_at,
                    updated_at,
                    last_interaction_at
                ) VALUES (
                    :external_id,
                    :display_name,
                    :avatar_url,
                    :gender,
                    :birthday,
                    :email,
                    :phone,
                    :source,
                    :created_at,
                    :updated_at,
                    :last_interaction_at
                )
                """
            ),
            insert_params,
        )
        member_id = result.lastrowid
    return int(member_id) if member_id is not None else None


QUESTION_TYPE_ALIASES: Dict[str, List[str]] = {
    "TEXT": ["TEXT", "INPUT", "SHORT_TEXT"],
    "TEXTAREA": ["TEXTAREA", "LONG_TEXT", "PARAGRAPH"],
    "SINGLE_CHOICE": ["SINGLE_CHOICE", "SINGLE", "RADIO", "CHOICE_SINGLE"],
    "MULTI_CHOICE": ["MULTI_CHOICE", "MULTI", "CHECKBOX", "CHOICE_MULTI", "MULTIPLE"],
    "SELECT": ["SELECT", "DROPDOWN", "PULLDOWN"],
    "NAME": ["NAME"],
    "PHONE": ["PHONE", "TEL", "MOBILE"],
    "EMAIL": ["EMAIL"],
    "BIRTHDAY": ["BIRTHDAY", "DOB", "DATE_OF_BIRTH", "DATE"],
    "ADDRESS": ["ADDRESS"],
    "GENDER": ["GENDER", "SEX"],
    "IMAGE": ["IMAGE", "PHOTO"],
    "VIDEO": ["VIDEO"],
    "ID_NUMBER": ["ID_NUMBER", "IDENTIFICATION"],
    "LINK": ["LINK", "URL"],
}

DEFAULT_QUESTION_TYPE = "TEXT"


def normalize_question_type(raw: Any) -> str:
    token = _clean(str(raw) if raw is not None else None)
    if not token:
        return DEFAULT_QUESTION_TYPE
    token = token.replace("-", "_").upper()
    for canonical, aliases in QUESTION_TYPE_ALIASES.items():
        if token == canonical or token in aliases:
            return canonical
    for canonical, aliases in QUESTION_TYPE_ALIASES.items():
        if any(alias in token for alias in aliases):
            return canonical
    return DEFAULT_QUESTION_TYPE


def register_survey_from_json(payload: Dict[str, Any]) -> Dict[str, Any]:
    """Persist a survey described by JSON payload."""
    if not isinstance(payload, dict):
        raise ValueError("payload must be a mapping")

    name = _clean(payload.get("name")) or "Survey"
    description = _clean(payload.get("description"))
    category = _clean(payload.get("category"))
    questions = payload.get("questions") or []
    if not isinstance(questions, list):
        raise ValueError("questions must be a list")

    now = utcnow()
    with engine.begin() as conn:
        result = conn.execute(
            text(
                """
                INSERT INTO surveys (name, description, category, is_active, created_at, updated_at)
                VALUES (:name, :description, :category, 1, :now, :now)
                """
            ),
            {"name": name, "description": description, "category": category, "now": now},
        )
        survey_id = int(result.lastrowid)

        for idx, question in enumerate(questions, start=1):
            if not isinstance(question, dict):
                continue
            q_type = normalize_question_type(question.get("question_type"))
            options = question.get("options") or question.get("options_json") or []
            if not isinstance(options, list):
                options = []
            entry = {
                "survey_id": survey_id,
                "question_type": q_type,
                "question_text": _clean(question.get("question_text")) or f"Question {idx}",
                "description": _clean(question.get("description")),
                "font_size": question.get("font_size") if isinstance(question.get("font_size"), int) else None,
                "options_json": json.dumps(options, ensure_ascii=False),
                "is_required": 1 if question.get("is_required") else 0,
                "display_order": question.get("order") if isinstance(question.get("order"), int) else idx,
                "created_at": now,
                "updated_at": now,
            }
            conn.execute(
                text(
                    """
                    INSERT INTO survey_questions (
                        survey_id,
                        question_type,
                        question_text,
                        description,
                        font_size,
                        options_json,
                        is_required,
                        display_order,
                        created_at,
                        updated_at
                    )
                    VALUES (
                        :survey_id,
                        :question_type,
                        :question_text,
                        :description,
                        :font_size,
                        :options_json,
                        :is_required,
                        :display_order,
                        :created_at,
                        :updated_at
                    )
                    """
                ),
                entry,
            )

    logger.info("Survey %s created with %s questions", survey_id, len(questions))
    return {"survey_id": survey_id, "question_count": len(questions)}


def load_survey_meta(survey_id: int) -> Dict[str, Any]:
    survey = fetchone(
        "SELECT id, name, description FROM surveys WHERE id = :sid", {"sid": survey_id}
    )
    if not survey:
        raise ValueError(f"survey {survey_id} not found")

    rows = fetchall(
        """
        SELECT id,
               question_type,
               question_text,
               description,
               font_size,
               options_json,
               is_required,
               display_order
          FROM survey_questions
         WHERE survey_id = :sid
         ORDER BY display_order ASC, id ASC
        """,
        {"sid": survey_id},
    )

    questions: List[Dict[str, Any]] = []
    for row in rows:
        options: List[Any]
        try:
            options = json.loads(row.get("options_json") or "[]")
        except json.JSONDecodeError:
            options = []
        questions.append(
            {
                "id": row["id"],
                "question_type": row["question_type"],
                "question_text": row["question_text"],
                "description": row.get("description"),
                "font_size": row.get("font_size"),
                "options": options,
                "is_required": bool(row.get("is_required")),
                "display_order": row.get("display_order"),
            }
        )

    return {
        "id": survey["id"],
        "name": survey["name"],
        "description": survey.get("description") or "",
        "questions": questions,
    }


def save_survey_submission(
    survey_id: int,
    answers: Dict[str, Any],
    participant: Optional[Dict[str, Any]] = None,
) -> None:
    """Store a survey response."""
    if not fetchone("SELECT 1 FROM surveys WHERE id=:sid", {"sid": survey_id}):
        raise ValueError("survey not found")
    if not isinstance(answers, dict):
        raise ValueError("answers must be a mapping")

    normalized: Dict[str, Any] = {}
    for key, value in answers.items():
        if not isinstance(key, str) or not key.startswith("q_"):
            continue
        suffix = key.split("_", 1)[1] if "_" in key else key
        if isinstance(value, list):
            normalized[suffix] = value
        elif value is None:
            normalized[suffix] = ""
        else:
            normalized[suffix] = str(value)

    participant = participant or {}
    external_id = (
        participant.get("external_id")
        or participant.get("id")
        or participant.get("identifier")
    )
    display_name = participant.get("display_name") or participant.get("name")
    email = participant.get("email")
    phone = participant.get("phone")

    member_id = upsert_member(
        external_id,
        display_name=display_name,
        email=email,
        phone=phone,
        source="form",
    )

    now = utcnow()
    execute(
        """
        INSERT INTO survey_responses (
            survey_id,
            member_id,
            external_id,
            answers_json,
            is_completed,
            completed_at,
            source,
            ip_address,
            user_agent,
            created_at,
            updated_at
        )
        VALUES (
            :survey_id,
            :member_id,
            :external_id,
            :answers_json,
            1,
            :completed_at,
            :source,
            :ip_address,
            :user_agent,
            :created_at,
            :updated_at
        )
        """,
        {
            "survey_id": survey_id,
            "member_id": member_id,
            "external_id": _clean(external_id),
            "answers_json": json.dumps(normalized, ensure_ascii=False),
            "completed_at": now,
            "source": "form",
            "ip_address": request.headers.get("X-Forwarded-For", request.remote_addr),
            "user_agent": request.headers.get("User-Agent"),
            "created_at": now,
            "updated_at": now,
        },
    )


SURVEY_TEMPLATE = """
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ survey.name or "Survey" }}</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", sans-serif; margin: 0; background: #f6f7fb; color: #111827; }
    .wrap { max-width: 720px; margin: 0 auto; padding: 32px 16px; }
    .card { background: #ffffff; border-radius: 16px; box-shadow: 0 20px 40px rgba(15, 23, 42, 0.12); padding: 28px; }
    h1 { margin: 0 0 16px; font-size: 24px; }
    .desc { margin: 0 0 24px; color: #475569; font-size: 15px; }
    .participant { border: 1px dashed #cbd5f5; border-radius: 12px; padding: 16px; margin-bottom: 24px; background: #f8fafc; }
    .participant label { display: block; font-weight: 500; margin-bottom: 12px; }
    .participant input { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #d1d9e6; font-size: 15px; margin-top: 6px; }
    .question { margin-bottom: 22px; }
    .prompt { display: block; font-weight: 600; margin-bottom: 8px; }
    .required { color: #dc2626; margin-left: 4px; }
    .description { font-size: 14px; color: #64748b; margin-bottom: 8px; }
    input[type="text"], input[type="tel"], input[type="email"], input[type="date"], input[type="url"], textarea, select {
      width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #d1d9e6; font-size: 15px; box-sizing: border-box;
    }
    textarea { min-height: 96px; resize: vertical; }
    .options { display: flex; flex-wrap: wrap; gap: 8px; }
    .chip { display: flex; align-items: center; gap: 6px; padding: 8px 12px; border: 1px solid #cbd5f5; border-radius: 999px; background: #f8fafc; cursor: pointer; }
    .chip input { margin: 0; }
    button { width: 100%; padding: 14px 16px; border: none; border-radius: 12px; background: #2563eb; color: #ffffff; font-size: 16px; font-weight: 600; cursor: pointer; }
    button:disabled { opacity: 0.7; cursor: wait; }
    .hint { margin-top: 16px; font-size: 13px; color: #64748b; }
    .status { margin-top: 18px; font-size: 15px; }
    .status.error { color: #b91c1c; }
    .status.success { color: #047857; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>{{ survey.name or "Survey" }}</h1>
      {% if survey.description %}
      <p class="desc">{{ survey.description }}</p>
      {% endif %}
      <form id="surveyForm">
        <input type="hidden" name="sid" value="{{ survey_id }}">
        <div class="participant">
          <label>
            Contact (optional)
            <input type="text" name="participant_id" placeholder="Email or phone">
          </label>
          <label>
            Name (optional)
            <input type="text" name="participant_name" placeholder="Your name">
          </label>
        </div>
        {% for q in survey.questions %}
        {% set qtype = (q.question_type or "").lower() %}
        {% set field_name = "q_" ~ q.id %}
        <div class="question" data-type="{{ qtype }}" data-id="{{ q.id }}"{% if q.is_required %} data-required="1"{% endif %}>
          <label class="prompt">{{ q.question_text or ("Question " ~ loop.index) }}{% if q.is_required %}<span class="required">*</span>{% endif %}</label>
          {% if q.description %}<div class="description">{{ q.description }}</div>{% endif %}
          {% if qtype in ["text", "name", "address", "phone", "email", "birthday", "id_number", "link"] %}
            {% set input_type = {
              "text": "text",
              "name": "text",
              "address": "text",
              "phone": "tel",
              "email": "email",
              "birthday": "date",
              "id_number": "text",
              "link": "url"
            }[qtype] if qtype in ["text","name","address","phone","email","birthday","id_number","link"] else "text" %}
            <input type="{{ input_type }}" name="{{ field_name }}"{% if q.is_required %} required{% endif %}>
          {% elif qtype == "textarea" %}
            <textarea name="{{ field_name }}"{% if q.is_required %} required{% endif %}></textarea>
          {% elif qtype in ["single_choice", "gender"] %}
            <div class="options">
              {% for opt in q.options %}
                {% set value = opt.value if opt.value is not none else (opt.label if opt.label is not none else "option_" ~ loop.index) %}
                {% set label = opt.label if opt.label is not none else (opt.value if opt.value is not none else "Option " ~ loop.index) %}
                <label class="chip">
                  <input type="radio" name="{{ field_name }}" value="{{ value }}"{% if q.is_required and loop.first %} required{% endif %}>
                  {{ label }}
                </label>
              {% endfor %}
              {% if not q.options %}
              <div>No options configured.</div>
              {% endif %}
            </div>
          {% elif qtype == "multi_choice" %}
            <div class="options">
              {% for opt in q.options %}
                {% set value = opt.value if opt.value is not none else (opt.label if opt.label is not none else "option_" ~ loop.index) %}
                {% set label = opt.label if opt.label is not none else (opt.value if opt.value is not none else "Option " ~ loop.index) %}
                <label class="chip">
                  <input type="checkbox" name="{{ field_name }}" value="{{ value }}"{% if q.is_required and loop.first %} required{% endif %}>
                  {{ label }}
                </label>
              {% endfor %}
              {% if not q.options %}
              <div>No options configured.</div>
              {% endif %}
            </div>
          {% elif qtype == "select" %}
            <select name="{{ field_name }}"{% if q.is_required %} required{% endif %}>
              <option value="">Select??/option>
              {% for opt in q.options %}
                {% set value = opt.value if opt.value is not none else (opt.label if opt.label is not none else "option_" ~ loop.index) %}
                {% set label = opt.label if opt.label is not none else (opt.value if opt.value is not none else "Option " ~ loop.index) %}
                <option value="{{ value }}">{{ label }}</option>
              {% endfor %}
            </select>
          {% else %}
            <input type="text" name="{{ field_name }}"{% if q.is_required %} required{% endif %}>
          {% endif %}
        </div>
        {% endfor %}
        <button type="submit" id="submitBtn">Submit</button>
        <p class="hint">We only use the information to support your request.</p>
      </form>
      <div id="formMessage" class="status" hidden></div>
    </div>
  </div>
  <script>
    const form = document.getElementById("surveyForm");
    const messageEl = document.getElementById("formMessage");
    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      messageEl.hidden = true;
      const sidField = form.querySelector("input[name='sid']");
      const sid = sidField ? Number(sidField.value) : NaN;
      if (!sid) {
        messageEl.textContent = "Invalid survey id.";
        messageEl.className = "status error";
        messageEl.hidden = false;
        return;
      }

      const sections = Array.from(form.querySelectorAll(".question"));
      const data = {};
      let missingRequired = false;

      sections.forEach((section) => {
        const type = (section.getAttribute("data-type") || "").toLowerCase();
        const id = section.getAttribute("data-id");
        const name = "q_" + id;
        const required = section.hasAttribute("data-required");

        if (type === "multi_choice") {
          const values = Array.from(
            section.querySelectorAll("input[type='checkbox'][name='" + name + "']:checked")
          ).map((el) => el.value);
          if (required && values.length === 0) {
            missingRequired = true;
          }
          data[name] = values;
        } else if (type === "single_choice" || type === "gender") {
          const chosen = section.querySelector("input[type='radio'][name='" + name + "']:checked");
          if (required && !chosen) {
            missingRequired = true;
          }
          data[name] = chosen ? chosen.value : "";
        } else if (type === "select") {
          const selectEl = section.querySelector("select[name='" + name + "']");
          const value = selectEl ? selectEl.value : "";
          if (required && !value) {
            missingRequired = true;
          }
          data[name] = value;
        } else {
          const field = section.querySelector("[name='" + name + "']");
          const value = field ? field.value : "";
          if (required && !value) {
            missingRequired = true;
          }
          data[name] = value;
        }
      });

      if (missingRequired) {
        messageEl.textContent = "Please complete the required fields.";
        messageEl.className = "status error";
        messageEl.hidden = false;
        return;
      }

      const participant = {
        external_id: (form.querySelector("input[name='participant_id']").value || "").trim(),
        display_name: (form.querySelector("input[name='participant_name']").value || "").trim()
      };
      if (!participant.external_id) {
        delete participant.external_id;
      }
      if (!participant.display_name) {
        delete participant.display_name;
      }

      const payload = { sid, data, participant };

      try {
        form.querySelector("#submitBtn").disabled = true;
        const response = await fetch("/__survey_submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const result = await response.json().catch(() => ({ ok: false, error: "Unexpected response." }));
        if (result.ok) {
          messageEl.textContent = "Thank you! Your response has been recorded.";
          messageEl.className = "status success";
          form.reset();
        } else {
          messageEl.textContent = result.error || "Unable to submit the survey.";
          messageEl.className = "status error";
        }
      } catch (err) {
        console.error("Submit error:", err);
        messageEl.textContent = "An unexpected error occurred.";
        messageEl.className = "status error";
      } finally {
        form.querySelector("#submitBtn").disabled = false;
        messageEl.hidden = false;
      }
    });
  </script>
</body>
</html>
"""


@app.get("/")
def index():
    """Serve the index.html file"""
    return send_from_directory(BASE_DIR, "index.html")


@app.get("/health")
def health() -> tuple[str, int]:
    return "OK", 200


@app.get(f"{ASSET_ROUTE_PREFIX}/<path:filename>")
def serve_uploads(filename: str):
    return send_from_directory(ASSET_LOCAL_DIR, filename, conditional=True)


@app.get("/survey/form")
def survey_form():
    sid = request.args.get("sid", type=int)
    if not sid:
        abort(400, "missing sid")
    try:
        meta = load_survey_meta(sid)
    except ValueError:
        abort(404, "survey not found")
    return render_template_string(SURVEY_TEMPLATE, survey=meta, survey_id=sid)


@app.get("/__survey_load")
def survey_load():
    sid = request.args.get("sid", type=int)
    if not sid:
        return jsonify({"error": "missing sid"}), 400
    try:
        data = load_survey_meta(sid)
    except ValueError as exc:
        return jsonify({"error": str(exc)}), 404
    return jsonify(data)


@app.post("/__survey_submit")
def survey_submit():
    if request.is_json:
        payload = request.get_json(force=True) or {}
        sid = payload.get("sid") or payload.get("survey_id")
        answers = payload.get("data") or payload.get("answers") or {}
        participant = payload.get("participant") or {}
    else:
        data = request.form.to_dict(flat=False)
        sid = data.get("sid", [None])[0]
        answers = {
            key: (values if len(values) > 1 else values[0])
            for key, values in data.items()
            if key.startswith("q_")
        }
        participant = {
            "external_id": (data.get("participant_id", [""])[0] or "").strip(),
            "display_name": (data.get("participant_name", [""])[0] or "").strip(),
        }

    try:
        sid_int = int(sid)
    except (TypeError, ValueError):
        return jsonify({"ok": False, "error": "invalid sid"}), 400

    try:
        save_survey_submission(sid_int, answers, participant)
    except ValueError as exc:
        return jsonify({"ok": False, "error": str(exc)}), 400

    return jsonify({"ok": True})


if __name__ == "__main__":
    port = int(os.getenv("PORT", "8300"))
    debug_mode = os.getenv("FLASK_DEBUG", "0") in {"1", "true", "True"}
    app.run(host="0.0.0.0", port=port, debug=debug_mode)
